# ä½œè€…çš„ç¢ç¢å¿µï¼ˆå¼€å‘æ—¥è®°ï¼‰

- 
    2021.07.04(ä¸‹åˆ):å¢åŠ äº†Quard Starå¼€å‘æ¿å®šä¹‰ï¼Œ8æ ¸æ”¯æŒï¼Œå¢åŠ ä¸­æ–­æ§åˆ¶å™¨ã€ä¸²å£ã€pflashã€‚æ·»åŠ ä½é˜¶å¯åŠ¨ä»£ç å›ºåŒ–åœ¨pflashè¿è¡Œã€‚
- 
    2021.07.05(æ™šä¸Š):å¢åŠ äº†opensbiæºç å¹¶æ·»åŠ platformæ”¯æŒä»£ç ï¼Œä½é˜¶å¯åŠ¨ä»£ç æ·»åŠ åŠ è½½sbiåŠŸèƒ½ã€‚
- 
    2021.07.09(æ™šä¸Š):å¢åŠ äº†opensbiè®¾å¤‡æ ‘ä¸­domainå®šä¹‰ï¼Œå¹¶å¢åŠ å®‰å…¨åŸŸçš„å·¥ç¨‹ä»£ç ï¼Œä½¿ç”¨å®‰å…¨åŸŸä¸²å£3æ‰“å°ï¼›å¢åŠ u-bootä»£ç å¹¶å¼•å¯¼è¿›å…¥éå®‰å…¨åŸŸæ‰§è¡Œï¼Œä½¿ç”¨ä¸²å£0æ‰“å°ã€‚
- 
    2021.07.10(ä¸­åˆ):å¢åŠ ubootçš„platformå®šä¹‰ä»¥åŠé…ç½®ç­‰ä»£ç ã€‚
- 
    2021.07.10(ä¸‹åˆ):ä½¿ç”¨ä¹‹å‰åˆ¶ä½œçš„æ ¹æ–‡ä»¶ç³»ç»ŸåŠå†…æ ¸æ˜ åƒå°è¯•å¼•å¯¼æ­£ç¡®ï¼Œè®¾å¤‡æ ‘æ–‡ä»¶æœ‰æ‰€æ”¹åŠ¨ï¼Œä¸”å‘ç°äº†ç‚¹é—®é¢˜ï¼Œ1.å½“å‰ç‰ˆæœ¬çš„opensbi fixä¸‹ä¸€çº§è®¾å¤‡æ ‘æ–‡ä»¶æ—¶ä¼šæ·»åŠ ä¸å¯ç”¨çš„domainåˆ°è®¾å¤‡æ ‘çš„reserved-memoryèŠ‚ç‚¹ï¼Œä½†å­˜åœ¨é‡å çš„æƒ…å†µï¼Œè¿™åœ¨u-bootä¸­è§£æè®¾å¤‡æ ‘æ—¶æ˜¯ä¼šæŠ¥warringçš„ï¼Œå› æ­¤è¿™é‡Œå°†åŸŸä¿®æ”¹ä¸ºåˆ†å—çš„åŸŸï¼Œå¹¶ä¸ä¼˜é›…ä½†æš‚æ—¶å°±è¿™ä¹ˆè§£å†³ã€‚2.u-bootåœ¨å¯åŠ¨bl1é˜¶æ®µä¼šæ‹·è´ä»£ç åˆ°ddré«˜åœ°å€ï¼Œè€Œå¦‚æœæˆ‘ä»¬å°†é«˜åœ°å€é…ç½®ä¸ºäº†ä¸å¯è®¿é—®çš„å®‰å…¨domainæ—¶ï¼Œå½“å‰u-bootçš„riscvå®ç°ä¸­æ²¡æœ‰æ£€æŸ¥æ˜¯å¦æ˜¯reserved-memoryåŒºåŸŸï¼Œè¿™é‡Œæˆ‘ä»¬ä¸ºäº†ç®€å•æœŸé—´ç›´æ¥åœ¨æˆ‘ä»¬çš„board platformä»£ç å±‚æ·»åŠ hookå‡½æ•°ä¿®æ”¹gd->ram_topæ¥å®ç°ï¼Œå…¶å®è¿™ç§æ–¹å¼æœ€ç®€å•é«˜æ•ˆï¼Œå¦‚æœéƒ½ä»è®¾å¤‡æ ‘é‡Œè§£ææœªå…è¿‡åº¦è®¾è®¡äº†ï¼Œè¿™é‡Œæœ¬å°±åªæ˜¯å¯åŠ¨å¼•å¯¼çš„ä¸€å°æ®µç¯èŠ‚è€Œå·²ï¼Œä½†æ˜¯çœ‹èµ·æ¥ubootçš„è¶‹åŠ¿è¶Šæ¥è¶Šå‘è§£æè®¾å¤‡æ ‘æ–¹å‘é è¿‘äº†ã€‚3.å¦å¤–å‘ç°linux5.10.42åœ¨qemuä½¿ç”¨-device virtio-gpu-deviceé©±åŠ¨å·¥ä½œä¸æ­£å¸¸ï¼Œå†…æ ¸oopsäº†ï¼Œç›®å‰ä¸æ¸…æ¥šæ˜¯qemu-6.0.0çš„é—®é¢˜è¿˜æ˜¯å†…æ ¸çš„ä»£ç ï¼Œè¿™ä¸ªæˆ‘æœ‰ç©ºå»æŸ¥ä¸€ä¸‹ã€‚
- 
    2021.07.11(ä¸Šåˆ):æ·»åŠ linux kernelçš„ç¼–è¯‘ï¼Œbusyboxçš„ç®€æ˜“ç¼–è¯‘ï¼Œç¼–å†™æ ¹æ–‡ä»¶ç³»ç»Ÿæ˜ åƒçš„æ‰“åŒ…è„šæœ¬ï¼Œæ·»åŠ ç®€æ˜“etcé…ç½®æ–‡ä»¶ï¼Œç»ˆäºshellè¿è¡ŒæˆåŠŸï¼Œåé¢è¦å¼€å§‹å®Œå–„ä¸€äº›ç³»ç»Ÿé…ç½®ï¼Œç”¨æˆ·æ€ç¨‹åºä»¥åŠå¢åŠ æ–°æ˜¾ç¤ºé©±åŠ¨è®¾å¤‡ï¼Œæˆ‘ä»¬æ‰“ç®—ç§»æ¤Qtç•Œé¢åˆ°ç³»ç»Ÿå†…ã€‚å¦å¤–å®‰å…¨åŸŸå†…çš„å›ºä»¶æ‰“ç®—ç§»æ¤ä¸€äº›RTOSç³»ç»Ÿï¼Œçœ‹æ˜¯ç§»æ¤FreeRTOSè¿˜æ˜¯RTThreadæ¯”è¾ƒå¥½å‘¢(âŠ™oâŠ™)?
- 
    2021.07.12(æ™šä¸Š):ä½¿ç”¨-device virtio-gpu-deviceé€‰é¡¹æ·»åŠ virtioæ˜¾ç¤ºè®¾å¤‡æ—¶ï¼Œå†…æ ¸å‡ºç°äº†oopsï¼Œåœ°å€è·‘é£çš„é—®é¢˜ï¼Œæˆ‘ç¨å¾®èŠ±äº†ç‚¹æ—¶é—´æŸ¥æ‰¾äº†ä¸€ä¸‹ï¼Œç›´æ¥é”™è¯¯å‡ºç°åœ¨linux-5.10.42/drivers/gpu/drm/virtio/virtgpu_kms.c:242è¡Œæ­¤å¤„vgdevä¸ºç©ºæŒ‡é’ˆï¼Œç›´æ¥è®¿é—®ä¼šå‡ºé”™ã€‚ä¸ºä»€ä¹ˆä¼šæ˜¯ç©ºæŒ‡é’ˆå‘¢ï¼ŒåŸæ¥æ˜¯å› ä¸º110è¡Œå¤„åˆå§‹åŒ–æ—¶æ£€æŸ¥VIRTIO_F_VERSION_1ä¸é€šè¿‡ï¼Œå› æ­¤é©±åŠ¨å¹¶æ²¡æœ‰æ­£å¸¸è¢«åŠ è½½ï¼Œè€Œåreleaseæ—¶å‡ºç°ç©ºæŒ‡é’ˆã€‚æ˜ç¡®äº†è¿™ä¸ªé—®é¢˜æˆ‘ä»¬å°±è¦å»qemuæºç é‡ŒæŸ¥æ‰¾ä¸€ä¸‹ä¸ºä»€ä¹ˆä¸æ”¯æŒè¿™ä¸ªVIRTIO_F_VERSION_1è¿™ä¸ªfeatureï¼Œç»è¿‡æŸ¥æ‰¾ç»ˆäºå‘ç°åœ¨qemu-6.0.0/hw/virtio/virtio-mmio.c:712å¤„ï¼Œåªæœ‰å®šä¹‰äº†proxy->legacyä¸ºfalseæ—¶æ‰èƒ½æ·»åŠ è¿™ä¸ªfeatureï¼Œè€Œ722è¡Œç»™å‡ºé»˜è®¤é…ç½®ä¸ºtrueï¼Œå› æ­¤æˆ‘ä»¬åœ¨è¿è¡Œqemué€‰é¡¹æ·»åŠ -global virtio-mmio.force-legacy=falseé€‰é¡¹åï¼Œç»ˆäºä¸€åˆ‡æ­£å¸¸äº†ã€‚è¿™é‡Œæˆ‘ä»¬å‚è€ƒä¸€ä¸‹è¿™ç¯‡[qemuå¼€å‘é‚®ä»¶](https://www.mail-archive.com/search?l=qemu-devel@nongnu.org&q=subject:%22Re%5C%3A+%5C%5BQemu%5C-devel%5C%5D+%5C%5BPATCH+v3%5C%5D+virtio%5C-mmio%5C%3A+implement+modern+%5C%28v2%5C%29%2C+personality+%5C%28virtio%5C-1%5C%29%22&o=newest&f=1)ä¸éš¾å‘ç°ï¼Œforce-legacyå®šä¹‰ä¸ºfalseæ‰æ˜¯æ›´æ–°ç‰ˆæœ¬çš„å®šä¹‰ï¼Œä½†å¯èƒ½æ˜¯è€ƒè™‘å…¼å®¹æ€§çš„é—®é¢˜qemué»˜è®¤è¿˜æ˜¯ç»™å‡ºäº†trueæ‰ç”¨ä¼ ç»Ÿçš„virtioè¡Œä¸ºã€‚è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é‡æ–°æ·»åŠ å†…æ ¸å‚æ•°é…ç½®ï¼Œä»¥åŠå†…æ ¸å®šä¹‰ä¸€ä¸ªæˆ‘ä»¬çš„quard_star_defconfigsæ–‡ä»¶ï¼Œæ·»åŠ æ˜¾ç¤ºlinuxå¯åŠ¨logoçš„é…ç½®ï¼Œå†æ¬¡å¯åŠ¨qemuï¼Œokï¼ä»¥ä¸‹ä¸ºä¸Šæ–‡éƒ¨åˆ†æè¿°ä¸­ä»£ç ç‰‡æ®µï¼š

    ```c
    â€¦â€¦
    110 if (!virtio_has_feature(dev_to_virtio(dev->dev), VIRTIO_F_VERSION_1))
    111		return -ENODEV;
    â€¦â€¦
    242 virtio_gpu_modeset_fini(vgdev);
    â€¦â€¦
    ```

    ```c
    â€¦â€¦
    712 if (!proxy->legacy) {
    713     virtio_add_feature(&vdev->host_features, VIRTIO_F_VERSION_1);
    714 }
    â€¦â€¦
    722 DEFINE_PROP_BOOL("force-legacy", VirtIOMMIOProxy, legacy, true),
    â€¦â€¦
    ```

- 
    2021.07.13(æ™šä¸Š):å°†å¯åŠ¨ä½¿ç”¨çš„shellä»busyboxæä¾›çš„shæ”¹ä¸ºæ ‡å‡†çš„bashï¼Œä»¥æ–¹ä¾¿åç»­å¼€å‘ã€‚ä¸è¿‡æœ€éº»çƒ¦çš„å°±æ˜¯ncursesåº“çš„ç¼–è¯‘å®‰è£…äº†ï¼ŒåŠ¨æ€åº“å¯ä»¥ä»äº¤å‰ç¼–è¯‘å·¥å…·é“¾ä¸­æ‹·è´ï¼Œä½†æ˜¯ä¸€äº›ç»ˆç«¯ç›¸å…³çš„é…ç½®æ–‡ä»¶å’Œæ•°æ®å°±è¦å»ç¼–è¯‘ncursesåº“æ¥å®‰è£…äº†ï¼Œå¥½åœ¨åŸºæœ¬ä¸Šæå®šäº†ã€‚å¦å¤–æ³¨æ„ä»è¿™é‡Œå¼€å§‹ï¼Œæˆ‘ä»¬æ–°å¢ç»™ç³»ç»Ÿroofs.imgä¸­æ·»åŠ çš„å†…å®¹éƒ½æ˜¯é€šè¿‡ç›®æ ‡è™šæ‹ŸæœºæŒ‚è½½å…±äº«ç›®å½•ç„¶åå®‰è£…çš„ï¼Œè€Œä¸æ˜¯æœ€å¤„ç”±è„šæœ¬æ„å»ºæ‰“åŒ…çš„ï¼Œå› æ­¤åŠ¡å¿…æ³¨æ„é™¤éimgè¢«ç ´åï¼Œå¦åˆ™ä¸è¦é‡æ–°æ„å»ºimgï¼Œå°½å¯èƒ½ä½¿ç”¨è™šæ‹Ÿæœºæœ¬èº«å»ä¿®æ”¹imgå†…çš„æ–‡ä»¶ã€‚
- 
    2021.07.14(æ™šä¸Š):æ·»åŠ rtcå’Œsysconåˆ°ç³»ç»Ÿå†…ï¼Œè§£å†³äº†è™šæ‹Ÿæœºå†…æ—¶é—´æˆ³ä¸å‡†ç¡®é—®é¢˜ï¼Œè§£å†³äº†rebootä¸èƒ½å¤ä½ç³»ç»Ÿï¼Œå¦å¤–ä¹‹å‰å†…æ ¸resetvecå­—æ®µæ²¡æœ‰å®šä¹‰åˆ°romçš„åŸºåœ°å€ï¼Œè€Œæ˜¯é»˜è®¤çš„0x1000(qemu-6.0.0/target/riscv/cpu.cçš„"resetvec"å­—æ®µå¯ä»¥çœ‹åˆ°é»˜è®¤å€¼)ï¼Œè™½æ²¡æœ‰äº§ç”Ÿé”™è¯¯ï¼Œä½†æ˜¯cpuå¯åŠ¨æ—¶ç¡®è®¤è¯»å…¥0x1000åœ°å€ï¼Œä¸æˆ‘ä»¬çš„æœŸæœ›ä¸ç¬¦ï¼Œè¿™æ¬¡rebootå¯ä»¥çœ‹åˆ°å…¶é”™è¯¯ï¼Œä¿®æ”¹åé—®é¢˜è§£å†³ã€‚å…³äºä¸Šè¿°cpuæ‰§è¡Œå¯åŠ¨åœ°å€é—®é¢˜ä½ å¯ä»¥æ·»åŠ qemuå¯åŠ¨é€‰é¡¹-d in_asm -D qemu_run_asm.logæ¥è§‚å¯Ÿè¡Œä¸ºã€‚å¦å¤–ç›®å‰çš„å®ç°rebootå’Œpoweroffè¿™ä¸¤ä¸ªé…ç½®åœ¨kernelçš„è®¾å¤‡æ ‘ä¸­å…¶å®æ˜¯ä¸å¤ªä¼˜é›…çš„è®¾è®¡ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„linuxå†…æ ¸ç‰ˆæœ¬ä¸­sbiå·²ç»æ”¯æŒäº†poweroffï¼Œæ‰€ä»¥syscon-poweroffæ³¨å†Œä¼šå¤±è´¥ï¼Œè€Œsyscon-rebootä¼šæ³¨å†ŒæˆåŠŸï¼Œå› ä¸ºsbiè¿˜æ²¡æœ‰å®ç°rebootï¼Œé‰´äºopensbiè¿˜åœ¨å¿«é€Ÿå¼€å‘é˜¶æ®µï¼Œç›¸ä¿¡è¿™ä¸ªé—®é¢˜å·²ç»åœ¨é€æ¸å®Œå–„äº†ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å…³æ³¨ä¸‹è¿™äº›é¡¹ç›®çš„ä¸»çº¿å¼€å‘åˆ†æ”¯æƒ…å†µï¼Œè¿™é‡Œæˆ‘ä»¬å°±ä¸å»çº ç»“è¿™ä¸ªè®¾è®¡äº†ã€‚
- 
    2021.07.15(æ™šä¸Š):å°†sudoå’Œscreenfetchç§»æ¤åˆ°ç³»ç»Ÿå†…ï¼Œscreenfetchç¨å¾®ä¿®æ”¹äº†ä¸€ç‚¹ï¼Œæ¯•ç«Ÿæˆ‘ä»¬æ˜¯busyboxä½†æ˜¯æ¢äº†æ ‡å‡†çš„bashï¼Œæ£€æµ‹æœ‰çš„é”™è¯¯ã€‚å¦å¤–ä»Šå¤©åœ¨@zhiliao007(wenqing.li@aliyun.com)çš„å¸®åŠ©ä¸‹ç¡®è®¤äº†å¼€å¯è¿™ä¸ªé¡¹ç›®çš„æ‰€éœ€è¦ä½¿ç”¨aptå®‰è£…çš„åŒ…ï¼Œç”±äºæˆ‘å¯åŠ¨é¡¹ç›®æ—¶ä½¿ç”¨çš„pcå·²ç»å®‰è£…äº†å¾ˆå¤šå¼€å‘ç¯å¢ƒäº†ï¼Œå› æ­¤ä¸€ç›´æ²¡èƒ½ç¡®è®¤å¦‚æœæ˜¯æ–°çš„Ubuntuä¸»æœºéœ€è¦å®‰è£…ä»€ä¹ˆåŸºç¡€åº“ï¼Œè¿™é‡Œæå‡ºæ„Ÿè°¢ã€‚
- 
    2021.07.17(ä¸‹åˆ):è¿™å‡ å¤©å·¥ä½œæœ‰ç‚¹å¿™ï¼Œç»ˆäºå‘¨æœ«æœ‰ç©ºç»§ç»­è¿™ä¸ªé¡¹ç›®äº†ï¼Œé¦–å…ˆæ˜¯è¿è¡Œqemuæ—¶ä½¿ç”¨gtkæ˜¾ç¤ºç•Œé¢æ˜¯ç›®å‰çœ‹èµ·æ¥æœ€ç†æƒ³çš„æ–¹å¼ï¼Œä¸ºäº†ä½¿ç”¨æ›´å¤§åˆ†è¾¨ç‡å»ºè®®æ·»åŠ é…ç½®ä½¿å…¶è‡ªåŠ¨ç¼©æ”¾å¯åŠ¨å‚æ•°å¦‚ä¸‹--display gtk,zoom-to-fit=falseã€‚ç„¶åæˆ‘å°†æˆ‘ä¸€ç›´åœ¨ç”¨çš„ä¸€äº›æ¯”è¾ƒå¥½ç”¨çš„å·¥å…·ç»§ç»­å‘ç³»ç»Ÿç§»æ¤tree,screen,cuè¿™ä¸‰ä¸ªå·¥å…·ï¼Œå°¤å…¶æ˜¯screenï¼Œæ¯•ç«Ÿåªæœ‰ç»ˆç«¯çš„æ—¥å­å¯èƒ½è¿˜è¦æŒç»­å¾ˆä¹…ï¼Œé‚£ä¹ˆä¸€ä¸ªæ¼‚äº®çš„å¤šç»ˆç«¯å·¥å…·å°±éå¸¸é‡è¦äº†ï¼Œè¿™äº›å·¥å…·çš„ç§»æ¤é…ç½®è¿˜ç®—æ˜¯å®¹æ˜“ï¼Œä½†æ˜¯ç»ˆç«¯çª—å£å¤§å°ä»ä¸»æœºæµ‹åŠ¨æ€ä¼ å…¥å°±æ¯”è¾ƒéº»çƒ¦äº†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬ä¹‹å‰çš„fw_cfgå°±èµ·åˆ°äº†å¤§ä½œç”¨ï¼Œæˆ‘ä»¬å¯åŠ¨è„šæœ¬è®¡ç®—äº†ç»ˆç«¯çª—å£å¤§å°é€šè¿‡fw_cfgä¼ å…¥ç›®æ ‡æœºï¼Œç„¶åç›®æ ‡æœºé€šè¿‡cat /sys/firmware/qemu_fw_cfg/by_name/opt/qemu_cmdline/rawå°±å¯ä»¥è¯»å–åˆ°ã€‚ä¸è¿‡æ³¨æ„äº†ï¼Œç”±äºqemuæ˜¯åœ¨6.0ç‰ˆæœ¬æ‰ç»™riscvæ¶æ„æ·»åŠ fw_cfgï¼Œè€Œlinux5.10.42è¿˜æ²¡æœ‰æ›´æ–°åˆ°ï¼Œå› æ­¤æˆ‘ä»¬è¿™é‡Œæ‰‹åŠ¨ç¨å¾®ä¿®æ”¹ä¸‹å†…æ ¸é‡Œçš„cofingå¹³å°è¿‡æ»¤é…ç½®å°±å¯ä»¥ä½¿ç”¨å•¦ã€‚ç›¸ä¿¡æœ€æ–°ç‰ˆä¸»çº¿ä¸Šlinuxå†…æ ¸å·²ç»æ›´æ–°äº†è¿™ä¸ªåŠŸèƒ½ï¼Œæ‰€ä»¥å¦‚æœæƒ³ä½“éªŒæ–°å†…æ ¸ä¹Ÿå¯ä»¥æ›´æ–°æœ€æ–°å†…æ ¸æ¥å°é²œã€‚ä¸‹é¢æ”¾å¼ å›¾çœ‹çœ‹å¼€å‘åˆ°å½“å‰çš„æ•ˆæœã€‚

    ![img0](./tutorial/img/img0.png)

- 
    2021.07.18(ä¸‹åˆ):ä»æ˜¨å¤©æ™šä¸Šå¼€å§‹å‡†å¤‡ç€æ‰‹æŠŠfreertosç§»æ¤åˆ°trusted_domainä¸­ï¼Œä½†æ˜¯ä¸‹è½½äº†ç›®å‰æœ€æ–°ç‰ˆæœ¬çš„freertoså‘ç°å®˜æ–¹æ²¡æœ‰åªæœ‰riscv Sæ¨¡å¼çš„ç§»æ¤åŒ…ï¼Œéƒ½æ˜¯åŸºäºMæ¨¡å¼ï¼Œé‚£å°±è‡ªå·±æ¥å¹²å§ï¼Œåæ­£FreeRTOSæ˜¯æˆ‘æœ€æœ€ç†Ÿæ‚‰çš„æ“ä½œç³»ç»Ÿï¼Œç»è¿‡ä¸€æ™šä¸ŠåŠ ä»Šå¤©å¤§åŠå¤©çš„æ—¶é—´ï¼Œç»ˆäºç§»æ¤æˆåŠŸäº†ï¼Œä¸»è¦æ˜¯ä¸‰éƒ¨åˆ†ï¼ŒTickä½¿ç”¨sbiç³»ç»Ÿè°ƒç”¨sbi_set_timerï¼Œä»»åŠ¡ä¸Šä¸‹æ–‡è°ƒåº¦ä¸»è¦åœ¨Sæ¨¡å¼ä¸è¦æ“ä½œé”™CSRå¯„å­˜å™¨äº†ï¼Œæœ€åæ˜¯portYIELDä½¿ç”¨sbi_send_ipiå‘è‡ªå·±æ ¸å¿ƒå‘é€è½¯ä¸­æ–­è¿›è¡Œã€‚ç›®å‰åŸºæœ¬åŠŸèƒ½ç§»æ¤æˆåŠŸï¼Œç›®å‰å·²çŸ¥è¿˜æœ‰ä¸¤ä¸ªç»†èŠ‚éœ€è¦ä¼˜åŒ–ï¼Œä¸€æ˜¯ä½¿ç”¨äº†ä¸­æ–­æ ˆä½†ä¸èƒ½æ”¯æŒåµŒå¥—ï¼Œsscratchæ²¡æœ‰åˆ©ç”¨åˆ°ä¹Ÿä¸é«˜æ•ˆï¼Œè¿™ä¸ªéœ€è¦åˆ†æä¸‹çœ‹ç©¶ç«Ÿèƒ½å¦æ”¯æŒä¸­æ–­åµŒå¥—ï¼ŒäºŒæ˜¯æµ®ç‚¹æ ˆå¸§æ²¡æœ‰ä¿å­˜æ¢å¤ï¼Œè¿™ä¸ªä¸‹æ¬¡æ·»åŠ æ—¶è¦ä»”ç»†è€ƒè™‘ï¼Œæœ€å¥½èƒ½å®ç°æƒ°æ€§å‹æ ˆã€‚ä¸è¿‡ç›®å‰çš„ç§»æ¤å¯¹äºå¤§éƒ¨åˆ†éœ€æ±‚æ¥è®²å·²ç»æ»¡è¶³äº†ã€‚ä¸çŸ¥é“æ˜¯ä¸æ˜¯å…¨ç½‘é¦–å‘çš„Sæ¨¡å¼Freertosç§»æ¤ï¼Œåæ­£æˆ‘æ˜¯æ²¡æ‰¾åˆ°æœ‰äººå‘å¸ƒã€‚æ¯•ç«ŸSæ¨¡å¼ä¸‹ï¼Œå®æ—¶æ€§å¯èƒ½ä¼šå¤‡å—æ‰“å‡»ï¼Œä½†æ˜¯ç›®å‰æˆ‘åœ¨qemuæµ‹è¯•è¿˜å¥½ï¼Œå½“ç„¶æˆ‘éœ€è¦è¿›ä¸€æ­¥æµ‹è¯•ï¼Œåé¢æ·»åŠ ä¸€äº›å®æ—¶ç³»ç»Ÿå’Œlinuxç³»ç»Ÿipcé€šè®¯çš„æµ‹è¯•çœ‹çœ‹ã€‚
- 
    2021.07.24(ä¸Šåˆ):è¿™å‘¨å¤´ç—›æ²¡å¤ªå¤šè¿›å±•ï¼Œè¿™æ¬¡ä¸»è¦æ˜¯ä½¿ç”¨äº† https://github.com/riscv/riscv-gnu-toolchain  tag:2021.08.07ï¼ˆ giteeé•œåƒï¼šhttps://gitee.com/mirrors/riscv-gnu-toolchain ï¼‰ï¼Œä»“åº“åˆ†åˆ«ç¼–è¯‘äº†ç”¨äºlinuxçš„ç¼–è¯‘å™¨å’Œç”¨äºè£¸æœºå¼€å‘çš„ç¼–è¯‘å™¨ï¼Œè¿™æ ·æœ‰ä¸‰ä¸ªå¥½å¤„ï¼Œç¬¬ä¸€æ˜¯è£¸æœºå¼€å‘èƒ½ä½¿ç”¨newlibçš„cåº“ï¼Œç¬¬äºŒæ˜¯ä¸ä¾èµ–åˆ«äººæä¾›çš„å·¥å…·é“¾ï¼Œæ–¹ä¾¿æˆ‘ä»¬debugæ—¶è·Ÿè¸ªæºç ï¼Œç¬¬ä¸‰æ˜¯æˆ‘ä»¬ç¼–è¯‘äº†gdbå·¥å…·æ— è®ºæ˜¯è£¸æœºè¿˜æ˜¯linuxä¸Šçš„appåº”ç”¨è°ƒè¯•å¯ä»¥ä½¿ç”¨gdbåˆ†æé—®é¢˜ã€‚æ›´æ–°äº†ç¼–è¯‘å™¨åé‡æ–°ç¼–è¯‘target_root_appæ—¶æˆ‘æ›´æ–°äº†ä¸€äº›ç¼–è¯‘è„šæœ¬ï¼Œä¼˜åŒ–äº†ä¹‹å‰ç¼–è¯‘æ—¶å¿½ç•¥çš„ç»†èŠ‚ï¼Œè¯¦ç»†å†…å®¹å¯ä»¥æŸ¥çœ‹target_root_appç›®å½•å†…çš„[README.md](./target_root_app/README.md)ï¼Œå¤§éƒ¨åˆ†éƒ½æ²¡æœ‰é—®é¢˜äº†ï¼Œä½†æ˜¯screenå·¥ä½œä¸æ­£å¸¸ï¼Œç²—ç•¥çš„debugäº†ä¸€ä¸‹è¿˜æ²¡æ‰¾åˆ°é—®é¢˜ï¼Œåé¢æœ‰ç©ºå†æŸ¥æ‰¾è¿™ä¸ªé—®é¢˜äº†ã€‚
- 
    2021.07.26(æ™šä¸Š):å‘¨æœ«å°é£å¤©ä¸€ç›´åœ¨debug screenå·¥ä½œä¸æ­£å¸¸çš„é—®é¢˜ï¼Œä»Šå¤©æ™šä¸Šç»ˆäºç»™è§£å†³äº†ã€‚è¿™é‡Œä¸€å®šè¦è®°å½•ä¸‹æ›²æŠ˜çš„å¿ƒè·¯å†ç¨‹(ï¼ï¹ï¼œ)ï¼é¦–å…ˆæ˜¯æ‰§è¡Œscreenåå‡ºç°â€œ[screen is terminating]â€åå°±ç¬é—´é€€å‡ºäº†ï¼Œå¾ˆè«åå…¶å¦™ï¼Œç¬¬ä¸€æƒ³æ³•å°±æ˜¯æ‰“å¼€ç¼–è¯‘screençš„Makefileæ–‡ä»¶ï¼ŒæŠŠâ€œOPTIONS= -DDEBUGâ€æ‰“å¼€ï¼Œç„¶åå†æ¬¡æ‰§è¡Œï¼Œä¼šåœ¨/tmp/debug/{SCREEN,screen}.*äº§ç”Ÿlogä¿¡æ¯ï¼ŒæŸ¥æ‰¾logå¹¶å¯¹æ¯”äº†ä¹‹å‰æ­£å¸¸å·¥ä½œlogï¼Œå®Œå…¨æ²¡å‘ç°ä»€ä¹ˆå¼‚å¸¸ï¼Œç„¶åæˆ‘å°è¯•äº¤å‰ç¼–è¯‘äº†straceå·¥å…·ï¼Œæ²¡æœ‰ä»€ä¹ˆå¼‚å¸¸å‘ç°ï¼Œæ²¡æœ‰åŠæ³•ï¼Œåªå¥½å»äº¤å‰ç¼–è¯‘äº†gdbå·¥å…·ï¼ˆäº¤å‰ç¼–è¯‘gdbæ—¶ä¼šæŠ¥å‡ºå¾ˆå¤šé”™è¯¯ï¼Œä¸»è¦è¿˜æ˜¯å®˜æ–¹çš„ç¼–è¯‘è„šæœ¬æœ‰æ¼æ´ï¼Œå‡æ˜¯è·¯å¾„é”™è¯¯ï¼Œæˆ‘æ‰‹åŠ¨ä¿®æ”¹åæœ€ç»ˆç¼–è¯‘æˆåŠŸï¼‰ç”Ÿæˆäº†ä¸€ä¸ªå¯ä»¥åœ¨ç›®æ ‡æ¿è¿è¡Œ çš„gdbå·¥å…·ï¼Œæ‹·è´åˆ°ç›®æ ‡æ¿ä¸­ï¼Œä½¿ç”¨gdbè°ƒè¯•ä¸€ç‚¹ç‚¹å®šä½é—®é¢˜ï¼Œå†æ¬¡æ‰“å¼€ç¼–è¯‘screençš„Makefileæ–‡ä»¶ï¼Œä¿®æ”¹æˆâ€œCFLAGS = -g -O0 -D_GNU_SOURCEâ€æ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨gdbè°ƒè¯•ã€‚å¾ˆå¿«æˆ‘å°±å‘ç°screen.c:1235è¿™é‡Œä¼šè°ƒç”¨forkï¼Œå¹¶ä¸”ä¸»è¿›ç¨‹åœ¨ä¹‹åå¹¶æ²¡æœ‰åšäº§ç”Ÿå¼‚å¸¸å°±æ”¶åˆ°äº†SIGHUPä¿¡å·é€€å‡ºäº†ï¼Œå› æ­¤å‡ºç°å¼‚å¸¸çš„åº”è¯¥æ˜¯è¿™é‡Œåˆ›å»ºçš„å­è¿›ç¨‹ã€‚æˆ‘æƒ³èµ·æ¥ä¹‹å‰straceå¯èƒ½æ²¡æœ‰æ£€æŸ¥å­è¿›ç¨‹çš„logï¼Œäºæ˜¯é‡æ–°ä½¿ç”¨â€œstrace -f /bin/screenâ€æ£€æŸ¥ï¼Œå´è¿˜æ˜¯æ²¡å‘ç°ä»€ä¹ˆå¼‚å¸¸ï¼Œå¥‡æ€ªï¼åªå¥½ç»§ç»­ç”¨gdbè·Ÿè¸ªå­è¿›ç¨‹ï¼Œæ–¹æ³•æ˜¯è¿›å…¥gdbåï¼Œä½¿ç”¨â€œset follow-fork-mode childâ€å‘½ä»¤æ¥æŒ‡ç¤ºgdbè·Ÿè¸ªå­è¿›ç¨‹ï¼Œç»è¿‡ä¸€ç•ªå®šä½æœ€ç»ˆscreen.c:1428çš„MakeWindow(&nwin)è¿”å›äº†-1å¼•èµ·é”™è¯¯ï¼Œè¿›ä¸€æ­¥è·Ÿè¸ªå‘ç°äº§ç”Ÿé”™è¯¯çš„è°ƒç”¨å…³ç³»æ˜¯è¿™æ ·ï¼š
    
    ```
    screen.c:1428:MakeWindow(&nwin)
    >>>>window.c:628:OpenDevice(nwin.args, nwin.lflag, &type, &TtyName)
    >>>>>>>>window.c:1132:OpenPTY(namep)
    >>>>>>>>>>>>pty.c:334:openpty(&f, &s, TtyName, NULL, NULL)
    ```
    
    çœ‹æ¥é—®é¢˜å°±å‡ºåœ¨openptyï¼Œè¿™ä¸ªå‡½æ•°å®šä¹‰åœ¨glibcä¸­login/openpty.c:86è¡Œï¼Œä½¿ç”¨gdbæ·±å…¥æŸ¥æ‰¾æˆ‘ä»¬å‘ç°openpty.c:99:master = getpt ();è¿”å›äº†-1ï¼Œè€Œgetptçš„å®šä¹‰æœ‰ä¸‰ä¸ªåˆ†åˆ«åœ¨login/getpt.cå’Œsysdeps/unix/bsd/getpt.cå’Œsysdeps/unix/sysv/linux/getpt.cï¼Œæˆ‘å¤§æ¦‚çŒœåˆ°é—®é¢˜äº†ï¼Œåº”è¯¥æ˜¯æˆ‘ä»¬è‡ªå·±ç¼–è¯‘çš„ç¼–è¯‘å™¨å’Œä¸‹è½½bootlinä¸Šçš„ç¼–è¯‘å™¨è¿™æ ·ä½¿ç”¨äº†ä¸åŒçš„getptï¼Œç»è¿‡ç¡®è®¤æˆ‘ä»¬è‡ªå·±ç¼–è¯‘å™¨ä½¿ç”¨çš„æ˜¯sysdeps/unix/sysv/linux/getpt.cï¼Œè€Œbootlinä¸Šçš„ç¼–è¯‘å™¨æˆ‘åªèƒ½çŒœæµ‹ä½¿ç”¨çš„æ˜¯sysdeps/unix/bsd/getpt.cï¼Œé‚£ä¹ˆåŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿlinuxé£æ ¼çš„ptyè®¾å¤‡æ˜¯æ‰“å¼€/dev/ptmxè¿›è€Œåœ¨/dev/ptsç›®å½•å†…äº§ç”ŸptyèŠ‚ç‚¹è®¾å¤‡ï¼Œè€ŒBSDé£æ ¼çš„ptyè®¾å¤‡åˆ™æ˜¯ç›´æ¥ä½¿ç”¨/dev/pty*è®¾å¤‡ã€‚é‚£ä¹ˆæˆ‘è‡ªå·±ç¼–å†™äº†ç®€å•çš„æµ‹è¯•ä»£ç openè®¾å¤‡/dev/ptmxï¼Œå‘ç°æœç„¶è¿”å›-1ï¼Œåªå¥½è¿›ä¸€æ­¥æŸ¥çœ‹å†…æ ¸çš„ç›¸å…³é…ç½®ï¼Œå‘ç°å…¶å®å†…æ ¸é‡Œå¯¹ä¸¤ç§é£æ ¼çš„ptyè®¾å¤‡éƒ½æ”¯æŒäº†ï¼Œå¦‚ä¸‹ï¼š
    
    ```
    CONFIG_UNIX98_PTYS=y
    CONFIG_LEGACY_PTYS=y
    CONFIG_LEGACY_PTY_COUNT=256
    ```
    
    ä½†æ˜¯è¦æ³¨æ„åˆ°[å†…æ ¸æ–‡æ¡£>devices.rst](https://elixir.bootlin.com/linux/v5.10.42/source/Documentation/admin-guide/devices.rst)ç¬¬155è¡Œæåˆ°äº†è¦å°†devptsæŒ‚è½½åˆ°/dev/ptsè¿™æ ·linuxé£æ ¼çš„ptyè®¾å¤‡æ‰èƒ½ä½¿ç”¨ï¼ŒåŸæ¥æ˜¯è¿™æ ·( ^_^ )ï¼æˆ‘ä»¬åœ¨ç›®æ ‡æ–‡ä»¶ç³»ç»Ÿé…ç½®æ–‡ä»¶/etc/fstabä½¿ç”¨mdevçš„æ–¹å¼ç”Ÿæˆ/devç›®å½•ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ç»™æˆ‘ä»¬åˆ›å»º/dev/ptsç›®å½•ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥åœ¨/etc/fstabæ·»åŠ æŒ‚è½½è®¾å¤‡ä¿¡æ¯ï¼Œé‚£æˆ‘ä»¬å°±è¿˜æ˜¯åœ¨/etc/init.d/rcSå¯åŠ¨è„šæœ¬ä¸­æ·»åŠ ï¼Œåœ¨/sbin/mdev -såæ·»åŠ 
    
    ```shell
    mkdir /dev/pts
    mount -t devpts devpts /dev/pts
    ```
    
    OKï¼Œæµ‹è¯•ä¸€ä¸‹screenï¼Œå®Œç¾è¿è¡Œï¼Œå¤§åŠŸå‘Šæˆã€‚
- 
    2021.07.27(æ™šä¸Š):æ·»åŠ äº†è¿è¡Œè„šæœ¬full-screené€‰é¡¹ï¼Œå¸Œæœ›èƒ½å…¨å±å¯åŠ¨ä¸”åˆ†è¾¨ç‡é€‚é…ä¸»æœºç¯å¢ƒï¼Œç„¶åå‘ç°qemuçš„gtkå‰ç«¯UIæœ‰ç‚¹é—®é¢˜ï¼Œåœ¨å›¾å½¢é©±åŠ¨å·¥ä½œå‰å¤„äºä½åˆ†è¾¨ç‡ï¼Œå®Œæˆé…ç½®ååˆ†è¾¨ç‡æ­£ç¡®åï¼Œgtkä¼šæ›´æ–°çª—ç”»é¢ï¼Œä½†æ˜¯å¦‚æœgtkè¿›å…¥å…¨å±æ¨¡å¼å°±ä¸ä¼šæ›´æ–°ï¼Œæœ€ç»ˆæ•´ä¸ªå…¨å±æ˜¾ç¤ºå°±å‡ºé—®é¢˜äº†ï¼Œæœ€ç»ˆå®šä½åˆ°qemu-6.0.0/ui/gtk.c:601è¿™é‡Œgd_update_windowsizeå‡½æ•°åªä¼šåœ¨éå…¨å±æ¨¡å¼æ›´æ–°sizeï¼Œäºæ˜¯æˆ‘ä»¬åšä»¥ä¸‹ä¿®æ”¹:

    ```c
    if(vc->s->full_screen){
        gtk_menu_item_activate(GTK_MENU_ITEM(vc->s->full_screen_item));
        gtk_menu_item_activate(GTK_MENU_ITEM(vc->s->full_screen_item));
    } else {
        gd_update_windowsize(vc);
    }
    ```

    è¿™æ ·å°±å¯ä»¥é’ˆå¯¹å…¨å±çš„æƒ…å†µä¸‹åˆ·æ–°æ­£ç¡®çš„sizeã€‚
- 
    2021.07.28(æ™šä¸Š):trusted_domainè£¸æœºç¨‹åºå¯ä»¥ä½¿ç”¨newlibäº†ï¼Œå› æ­¤ä¿®æ”¹äº†ä¸€ä¸‹å¯åŠ¨è„šæœ¬å¹¶åšäº†ç›¸å…³newlibæ¡©å‡½æ•°çš„ç§»æ¤ï¼Œç„¶åç¼–è¯‘å‘ç°å‡ºé”™ï¼ŒåŸæ¥æ˜¯å› ä¸ºæˆ‘ä»¬ä½¿ç”¨ç¼–è¯‘é€‰é¡¹-mcmodel=medanyæ¥ä¿è¯ç¨‹åºå¯ä»¥é“¾æ¥åˆ°0x80000000ä»¥ä¸Šçš„é«˜åœ°å€ï¼Œä½†æ˜¯é»˜è®¤ç¼–è¯‘çš„å¸¦newlibçš„ç¼–è¯‘å™¨ä½¿ç”¨äº†-mcmodel=medlowæ¥ç¼–è¯‘cåº“ï¼Œå› æ­¤æ— æ³•é“¾æ¥ï¼Œåˆè¸©åˆ°ä¸€ä¸ªå‘ï¼Œåªå¥½é‡æ–°ç¼–è¯‘äº†ã€‚æœ€ç»ˆæ€»ç»“ç¼–è¯‘å‘½ä»¤å¦‚ä¸‹:

    ```shell
    # ç”¨äºè£¸æœºå¸¦newlibçš„gcc
    ./configure --prefix=/opt/gcc-riscv64-unknown-elf --with-cmodel=medany
    make -j16
    # ç”¨äºlinuxå¸¦glibcçš„gcc
    ./configure --prefix=/opt/gcc-riscv64-unknown-linux-gnu
    make linux -j16
    ```
    åˆ°è¿™é‡Œæˆ‘ä»¬çš„ç¼–è¯‘å™¨åŸºæœ¬æ›´æ¢å®Œæˆï¼Œåé¢å¦‚æœé‡åˆ°é—®é¢˜ç»ˆäºä¸ç”¨æ‹…å¿ƒåˆ«äººæä¾›çš„äºŒè¿›åˆ¶å¼€å‘å·¥å…·æ˜¯å¦å­˜åœ¨é—®é¢˜äº†ï¼Œæˆ‘ä»¬æ‹¥æœ‰å…¨éƒ¨çš„æºç å¯ä»¥è‡ªè¡Œç¼–è¯‘ã€debugã€fixé—®é¢˜ï¼ŒO(âˆ©_âˆ©)Oå“ˆå“ˆ~ 
- 
    2021.07.29(æ™šä¸Š):æ·»åŠ äº†qt-5.12.11ï¼Œé¡ºåˆ©å®Œæˆäº†äº¤å‰ç¼–è¯‘ï¼Œä¹‹å‰å°è¯•äº†qt-5.15.2ç‰ˆæœ¬ï¼Œå‘ç°è¯¥ç‰ˆæœ¬åœ¨ä¸æ‰“å¼€openglçš„æƒ…å†µä¸‹å­˜åœ¨bugæ— æ³•æ­£å¸¸ç¼–è¯‘ï¼Œ[Qt bugreports](https://bugreports.qt.io/browse/QTBUG-88017)ä¸Šå·²ç»æœ‰æè¿°è¯¥é—®é¢˜äº†ï¼Œå› æ­¤æˆ‘ä»¬è¿™é‡Œä½¿ç”¨æ¯”è¾ƒç¨³å®šçš„ltsç‰ˆæœ¬5.12.11ã€‚
- 
    2021.07.30(æ™šä¸Š):å†…æ ¸å¢åŠ CONFIG_INPUT_EVDEVé€‰é¡¹ä»¥æ–¹ä¾¿qtåº”ç”¨ä½¿ç”¨/dev/input/event*è®¾å¤‡æ¥è·å–é¼ æ ‡å’Œé”®ç›˜è¾“å…¥äº‹ä»¶ã€‚ç¼–è¯‘äº†å‡ ä¸ªæµ‹è¯•ç¤ºä¾‹qt guiåº”ç”¨ï¼Œä¸€åˆ‡æ­£å¸¸ï¼Œæ³¨æ„æ·»åŠ ä¸€äº›ç¯å¢ƒå˜é‡ç¡®ä¿qtåº”ç”¨è¿è½¬æ­£å¸¸ã€‚ç›®å‰è¿˜æ²¡å®Œå…¨éƒ¨ç½²å¥½Qtåº“åˆ°ä»£ç é‡Œï¼Œæˆ‘æƒ³å¤šæµ‹è¯•ä¸€äº›åŠŸèƒ½å†è€ƒè™‘ç»†èŠ‚çš„éƒ¨ç½²é—®é¢˜ï¼Œè®©éƒ¨ç½²å’Œè°ƒè¯•å˜å¾—ä¼˜é›…ã€‚

    ```
    export QT_QPA_FB_DRM=1
    export QT_QPA_GENERIC_PLUGINS=evdevkeyboard
    export QT_QPA_GENERIC_PLUGINS=evdevmouse
    export QT_QPA_EVDEV_MOUSE_PARAMETERS=/dev/input/event0
    export QT_QPA_EVDEV_KEYBOARD_PARAMETERS=/dev/input/event1
    export QT_PLUGIN_PATH=/home/root/plugins
    ```

    å¦å¤–å¹´åˆä¸æ˜¯åŸºäºQtç§»æ¤äº†ä¸ªä¸–å˜‰å’ŒFCçš„æ¨¡æ‹Ÿå™¨ï¼Œåˆšå¥½ä¹ŸæŠŠè¿™ä¸ªé¡¹ç›®ä¹Ÿéƒ¨ç½²åˆ°ç°åœ¨çš„ç¯å¢ƒé‡Œçœ‹çœ‹æ•ˆæœï¼Œç¼–è¯‘éå¸¸é¡ºåˆ©ï¼Œè¯•è¿è¡Œå¦‚ä¸‹å›¾ï¼š

    ![img1](./tutorial/img/img1.gif)

    ![img2](./tutorial/img/img2.gif)

    å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆï¼Œè¿™å¤ªæç¬‘äº†ï¼Œå±…ç„¶æˆåŠŸåœ¨x86çš„pcä¸­è¿è¡Œqemuæ¨¡æ‹Ÿçš„riscvå¹³å°é‡Œè¿è¡Œlinuxç³»ç»Ÿå¹¶ç§»æ¤çš„åŸºäºfbçš„qtæ¡†æ¶é‡Œè·‘æ¨¡æ‹Ÿm68kæ¶æ„åº”ç”¨ç¨‹åºæˆåŠŸè¿è¡Œäº†ä¸–å˜‰mdæ¸¸æˆï¼Œå±‚å±‚å¥—å¨ƒï¼Œè¯•ç©ä¸€ä¸‹ï¼Œå¸§ç‡ä¸å¯è¨€è¡¨ï¼Œå“ˆå“ˆå“ˆå“ˆï¼ˆç¬‘å“­ï¼‰ï¼
- 
    2021.08.01(ä¸‹åˆ):æ·»åŠ ç½‘ç»œç›¸å…³çš„é…ç½®è„šæœ¬ï¼Œä¿®æ”¹å¯åŠ¨è„šæœ¬é…ç½®ç½‘ç»œdhcpç­‰åŠŸèƒ½ï¼Œæ·»åŠ ç½‘ç»œç›¸å…³çš„å·¥å…·ethtoolå’Œiperfã€‚æ¯”è¾ƒé¡ºåˆ©æ²¡å•¥å¤§é—®é¢˜æ³¨æ„ä¸‹/etc/inittabå†…çš„è¯­æ³•æ˜¯busyboxçš„ä¸æ˜¯sysvinitçš„ä¸è¦æé”™äº†ã€‚
- 
    2021.08.02(æ™šä¸Š):æ·»åŠ ä¸€ç³»åˆ—å¯åŠ¨è„šæœ¬ï¼Œå†…å®¹å‚è€ƒè‡ªbuildrootçš„é…ç½®ã€‚æ·»åŠ zlibå’Œopensshæºç ï¼Œæ·»åŠ ç¼–è¯‘è„šæœ¬å¹¶éƒ¨ç½²å®Œæˆï¼Œqemuä½¿ç”¨ç«¯å£è½¬å‘22ç«¯å£åˆ°ç‰©ç†æœº3522ç«¯å£ï¼Œsshå’Œsftpå·²æµ‹è¯•å®Œå…¨å¯ç”¨ï¼Œè¿™å‘¨æœ«å¼€å§‹å®Œæˆä¸€äº›ç½‘ç»œç›¸å…³çš„å†…å®¹ï¼Œä¸è¿‡ä¸ªäººåœ¨ç½‘è·¯è¿™å—è¿˜æ˜¯å°ç™½åˆå­¦è€…ï¼Œå¥½åœ¨è¿™å—ç›®å‰å®Œå…¨æ²¡æœ‰é‡åˆ°å‘ï¼Œè€Œä¸”èµ„æ–™æ•™ç¨‹é¢‡å¤šï¼Œæˆ‘æœ€è¿‘ä¹Ÿè¦å¼€å§‹å¥½å¥½å­¦ä¹ è¿™æ–¹é¢çš„åº•å±‚çŸ¥è¯†ï¼Œåé¢æœ¬é¡¹ç›®çœ‹æƒ…å†µç¼“æ›´ã€‚
- 
    2021.08.06(æ™šä¸Š):target_root_appé‡Œçš„ä¸€äº›å·¥å…·ç¼–è¯‘å¯èƒ½åœ¨åŸç‰ˆçš„ubuntu18.04ä¸Šä¸èƒ½ç›´æ¥ç¼–è¯‘é€šè¿‡ï¼Œä¸ºäº†ç¡®ä¿èƒ½é¡ºåˆ©åç§»é€šè¿‡ï¼Œä»¥ç›®å‰çš„ç‰ˆæœ¬çœ‹æ¥ï¼Œautomakeçš„ç‰ˆæœ¬é€‰ç”¨1.16.1ï¼Œpkg-configé€‰æ‹©0.29.2ï¼Œæˆ‘ä»¬ç›´æ¥å¼•å…¥æºç å®‰è£…åˆ°host_outputç›®å½•ä¸‹ï¼Œåç»­ä½¿ç”¨host_outputä¸‹çš„automakeå·¥å…·æ‰§è¡Œç¼–è¯‘æµç¨‹ã€‚
- 
    2021.08.14(ä¸‹åˆ):æœ€è¿‘åœ¨æŒç»­è¡¥å……åšå®¢æ–‡æ¡£ã€‚ä»Šå¤©ä¸Šæµ·æš´é›¨å€¾ç›†ï¼Œä¸€å£æ°”å®Œæˆäº†ä¸‰ç¯‡å·²ç»æ›´æ–°åˆ°ch15ã€‚å”‰ï¼Œè¯´èµ·æ¥ä»Šå¤©è¿˜æ˜¯ä¸ƒå¤•èŠ‚ï¼Œä¸ºä»€ä¹ˆæˆ‘è¦åœ¨å®¶äº›åšå®¢å‘¢ï¼Ÿå½“ç„¶æ˜¯å› ä¸ºä»Šå¤©çº¦å¥³å­©å­æ²¡çº¦åˆ°å•Šï¼ˆè‹¦æ¶©ï¼‰ï¼ï¼ï¼è¿™æ¬¡æ›´æ–°å¤Ÿå¤šäº†ï¼Œä¼‘æ¯å»åˆ·å‰§äº†ã€‚
- 
    2021.08.18(æ™šä¸Š):å°è¯•äº†ä¸€ä¸‹openjdk11çš„äº¤å‰ç¼–è¯‘ï¼Œä¾èµ–å¤ªå¤šäº†ï¼Œå°¤å…¶æ˜¯x11é‚£ä¸€å¥—åº“ï¼Œä¸è¿‡å€’æ˜¯æˆåŠŸå®Œæˆäº†ï¼Œè€Œä¸”è¿™æ¬¡æ˜¯å½»åº•æŠŠautomakeï¼Œpkg-configçš„å®ç°é€»è¾‘ææ˜ç™½äº†ã€‚openjdk zeroå®åœ¨æ˜¯æ€§èƒ½å¤ªå·®äº†ï¼Œè¿è¡Œä¸€æ¡æŸ¥çœ‹ç‰ˆæœ¬çš„å‘½ä»¤éƒ½è¦æ‰§è¡Œä¸ƒå…«åˆ†é’Ÿï¼Œå›å¤´æœ‰æœºä¼šç ”ç©¶ä¸‹jitçš„å®ç°ä»£ç ï¼Œè™½ç„¶æˆ‘è¿˜ä¸è§‰å¾—è‡ªå·±æœ‰èƒ½åŠ›ç§»æ¤åˆ°rvä¸Šï¼Œä½†æ˜¯è¿™ä¸ªäº‹æƒ…è¿˜æ˜¯è›®æœ‰è¶£çš„ã€‚
- 
    2021.08.21(ä¸Šåˆ):ç»§ç»­åŠ é€ŸæŠŠç³»åˆ—åšå®¢ç¼–è¾‘å®Œæˆï¼Œä¸€å£æ°”å®Œæˆ3èŠ‚ï¼Œç›®å‰åˆ°äº†ch19èŠ‚ï¼Œå·²æœ‰è®¡åˆ’è¿˜å‰©ä¸‹ch20-ch25è¿™6èŠ‚ï¼Œäº‰å–æ¥ä¸‹æ¥å‡ å¤©å…¨éƒ¨æ›´æ–°å®Œæˆï¼ŒåŠ æ²¹â†–(^Ï‰^)â†—ã€‚
- 
    2021.08.21(æ™šä¸Š):æ²¡æƒ³åˆ°æ—©ä¸Šè¯´å°½å¿«æŠŠæ–‡æ¡£ç¼–è¾‘å®Œæˆï¼Œç»“æœä¸‹åˆåˆ°æ™šä¸Šä¸€å£æ°”å°±å…¨éƒ¨æ›´å®Œäº†ï¼Œåé¢è¿™ä¸ªé¡¹ç›®å°±å°†çœŸæ­£è¿›å…¥ç¼“æ›´æœŸäº†ï¼Œç¬”è€…åé¢ä¹Ÿéœ€è¦å»å­¦ä¹ è¡¥å……è‡ªå·±è¿˜ä¸ç†Ÿæ‚‰çš„æŠ€æœ¯æ ˆäº†ã€‚
- 
    2021.10.16(ä¸‹åˆ):åˆå›æ¥æ›´æ–°è¿™ä¸ªé¡¹ç›®äº†ï¼Œé¦–å…ˆå°±æ˜¯ç»™æˆ‘ä»¬çš„è™šæ‹ŸSOCæ·»åŠ ä¸‰ä¸ªi2cæ§åˆ¶å™¨ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©qemuå·²æœ‰çš„å®ç°imx-i2cï¼Œè¿™ä¸ªæ˜¯åœ¨NXPçš„imxç³»åˆ—ä¸­çš„i2c ipï¼Œè¿˜æ˜¯æ¯”è¾ƒé¡ºåˆ©çš„ï¼Œå¾ˆå®¹æ˜“å°±æ·»åŠ å¥½äº†ï¼Œä¹‹åæˆ‘ä»¬åœ¨i2c0ä¸ŠæŒ‚è½½ä¸€å— at24c64 eepromï¼Œç¼–å†™è®¾å¤‡æ ‘æ–‡ä»¶ï¼Œåœ¨linuxå†…æ ¸ä¸­æ·»åŠ ç›¸å…³é©±åŠ¨ï¼Œå¾ˆè½»æ¾å°±è¯†åˆ«åˆ°äº†i2cæ§åˆ¶å™¨ä»¥åŠat24c64ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯ä»¥æµ‹è¯•eepromçš„è¯»å†™æƒ…å†µã€‚

    ```
    echo hello > /sys/bus/i2c/devices/0-0050/eeprom
    cat /sys/bus/i2c/devices/0-0050/eeprom
    ```

- 
    2021.10.17(ä¸Šåˆ):ç»§ç»­ç»™æˆ‘ä»¬çš„è™šæ‹ŸSOCæ·»åŠ ä¸¤ä¸ªspiæ§åˆ¶å™¨ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©qemuå·²æœ‰çš„å®ç°sifive_spiï¼Œè½»è½¦ç†Ÿè·¯ï¼Œä¹‹åæˆ‘ä»¬åœ¨spi0ä¸ŠæŒ‚è½½ä¸€å—is25wp256çš„norflashï¼Œç¼–å†™è®¾å¤‡æ ‘æ–‡ä»¶ï¼Œåœ¨linuxå†…æ ¸ä¸­æ·»åŠ ç›¸å…³é©±åŠ¨ï¼Œè®°å¾—æ·»åŠ mtdè®¾å¤‡é©±åŠ¨ï¼Œç„¶åå°±å¾ˆé¡ºåˆ©çš„çœ‹åˆ°æœ‰/dev/mtd1çš„è®¾å¤‡å‡ºç°ï¼ˆmtd0æ˜¯ä¹‹å‰æˆ‘ä»¬çš„SOCå†…éƒ¨ç›´è¿çš„å¹¶è¡Œpflashï¼‰ï¼Œmtdè®¾å¤‡æµ‹è¯•å°±ä¸å¤šè¯´äº†ï¼Œç›´æ¥æ“ä½œmtdblock1å°±å¯ä»¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨mtd_debugå°å·¥å…·æ¥æ“ä½œã€‚æˆ‘ä»¬çš„socå†…éƒ¨æ§åˆ¶å™¨å¼€å§‹è¶Šæ¥è¶Šä¸°å¯Œäº†ï¼Œå› æ­¤è¿™é‡Œè¦æ•´ç†ä¸€ä¸‹qemu-6.0.0/hw/riscv/quard_star.cä»£ç ï¼Œä¹‹å‰æ˜¯åŸºæœ¬ä¸Šä»virt.cç®€åŒ–è€Œæ¥çš„ï¼Œç”±äºä¾§é‡ç‚¹ä¸åŒå› æ­¤å¯¹äºæˆ‘ä»¬æ¥è¯´å…¶ä»£ç å¯è¯»æ€§ä¸å¥½ï¼Œè¿™é‡Œæˆ‘é‡æ„äº†ä¸‹ï¼Œé’ˆå¯¹æ¯ä¸ªä¸åŒçš„æ§åˆ¶å™¨åˆ†åˆ«ç¼–å†™ç‹¬ç«‹çš„createå‡½æ•°ï¼Œç°åœ¨ä»£ç æ•´æ´å¤šäº†ã€‚

    ```c
    static void quard_star_machine_init(MachineState *machine)
    {
        quard_star_cpu_create(machine);
        quard_star_interrupt_controller_create(machine);
        quard_star_memory_create(machine);
        quard_star_flash_create(machine);
        quard_star_syscon_create(machine);
        quard_star_rtc_create(machine);
        quard_star_serial_create(machine);
        quard_star_i2c_create(machine);
        quard_star_spi_create(machine);
    
        quard_star_virtio_mmio_create(machine);
        quard_star_fw_cfg_create(machine);
    }
    ```

- 
    2021.10.30(ä¸Šåˆ):æœ€è¿‘å¿ƒæƒ…çŠ¶æ€ç¨³å®šå¾ˆå¤šï¼Œè¿˜æŒºå¼€å¿ƒçš„ï¼Œç»§ç»­æ›´æ–°è¿™ä¸ªé¡¹ç›®ï¼Œé¦–å…ˆå°±æ˜¯è®¾å¤‡æ ‘æ–‡ä»¶ï¼Œä¹‹å‰ä¹Ÿæ˜¯ä¸ºäº†ç›´è§‚ä¸€ç‚¹ç‚¹æ·»åŠ å†…å®¹çš„ï¼Œè¿™å¯¹äºåˆå­¦è€…æ¸è¿›å¼çš„å­¦ä¹ å¾ˆæœ‰å¸®åŠ©ï¼Œä½†æ˜¯éšç€è®¾å¤‡æ•°ä¿¡æ¯æ„ˆå‘è†¨èƒ€ï¼Œå¹³é“ºå¼çš„å†™æ³•å°†éš¾ä»¥é˜…è¯»ï¼Œå¿…é¡»é‡æ„ä¸ºç»“æ„åŒ–çš„å½¢å¼ï¼Œè¿™é‡Œé‡æ–°ç¼–å†™ä»¥ä¸‹ä¸‰ä¸ªæ–‡ä»¶quard_star_sbi.dtsã€quard_star_uboot.dtsã€quard_star.dtsiï¼Œdtsiä¸ºå…¬å…±çš„SOCå†…éƒ¨è®¾å¤‡ä¿¡æ¯ï¼Œå¦å¤–ä¸¤ä»½dtsåˆ™å¼•ç”¨dtsiå¹¶é’ˆå¯¹å„è‡ªçš„éœ€è¦ä½¿èƒ½ç›¸å…³æ§åˆ¶å™¨ï¼Œè€ŒæŒ‚è½½åˆ°æ§åˆ¶å™¨ä¹‹ä¸Šçš„å¤–éƒ¨è®¾å¤‡åŒæ ·ä¹Ÿå†™åœ¨dtsä¸­è€Œä¸æ˜¯dtsiä¸­ã€‚å¦å¤–å°†è¿™ä¸ªä»“åº“å¯¼å…¥CodeFactorä¸­ï¼Œæ ¹æ®æç¤ºä¼˜åŒ–äº†éƒ¨åˆ†é£æ ¼ä¸è‰¯çš„ä»£ç ï¼Œåç»­ä¸ä»…è¦è®©ä»£ç æ­£ç¡®è¿è¡Œï¼Œè¿˜è¦å¯¹ä»£ç é£æ ¼å’Œå¯è¯»æ€§åšè¿›ä¸€æ­¥è¦æ±‚ã€‚
- 
    2021.11.06(ä¸Šåˆ):é¦–å…ˆæ˜¯ä¼˜åŒ–äº†ubootä¸­distro boot scriptï¼Œç°åœ¨æˆ‘ä»¬æ”¯æŒtftpbootï¼Œåç»­debugæ—¶å°±ä¸ç”¨æ¯æ¬¡æ„å»ºå¸¦æœ‰å†…æ ¸ä¿¡æ¯çš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»…ä»…éœ€è¦ç¼–è¯‘ç”Ÿæˆå¯åŠ¨å›ºä»¶ç„¶åé€šè¿‡tftpåŠ è½½å³å¯ï¼Œè„šæœ¬å†…å®¹å¦‚ä¸‹ï¼Œæ˜¯é€šè¿‡åŠ è½½ä¸»æœºtftpæœåŠ¡å™¨ä¸­boot.cfgæ–‡ä»¶åˆ¤æ–­æ˜¯å¦å†…å®¹ä¸ºâ€œtftpâ€ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶æˆ–å†…å®¹ä¸æ˜¯tftpåˆ™è¿˜æ˜¯èµ°ä¹‹å‰çš„å¯åŠ¨æµç¨‹ã€‚

    ```
    # try use tftp load boot.cfg
    mw.l ${kernel_addr_r} 0x0
    dhcp ${kernel_addr_r} /boot.cfg
    
    # load bootfile according to boot.cfg
    if itest.l *${kernel_addr_r} == 0x70746674; 
    then 
        echo tftpboot...
        dhcp ${kernel_addr_r} /linux_kernel/Image
        dhcp ${fdt_addr_r} /uboot/quard_star_uboot.dtb
    else
        echo virtioboot...
        load virtio 0:1 ${kernel_addr_r} /Image
        load virtio 0:1 ${fdt_addr_r} /quard_star.dtb
    fi
    
    # boot kernel
    booti ${kernel_addr_r} - ${fdt_addr_r}
    ```

- 
    2021.11.06(ä¸‹åˆ):åº”è¯¥æ˜¯è¿™å‘¨æœ€åä¸€æ¬¡æ›´æ–°ï¼Œè¯´èµ·æ¥ä»Šå¤©è¿˜æœ‰ç‚¹å°å¿§ä¼¤ï¼Œè¿™ç¯‡æ›´æ–°å®Œæ¯•æ™šä¸Šå‡†å¤‡ç»™è‡ªå·±åšé¡¿ç›ç„—é¸¡ç¿…ã€‚ä¸æ‰¯åºŸè¯äº†ï¼Œè¿™æ¬¡æˆ‘ä»¬ç»™è™šæ‹ŸSOCæ·»åŠ ä¸€ä¸ªUSBæ§åˆ¶å™¨ï¼Œqemuä¸­æœ‰dwc3çš„åŠæˆå“å®ç°ï¼Œä¸ºå•¥æ˜¯åŠæˆå“å‘¢â€”â€”å› ä¸ºåªå®ç°äº†hostæ¨¡å¼ï¼Œè€Œæ²¡æœ‰å®ç°otgã€‚dwc3è¿™ä¸ªæ§åˆ¶å™¨æƒ³å¿…åšåµŒå…¥å¼çš„æœ‹å‹éƒ½å¤ªç†Ÿæ‚‰äº†ï¼ŒSynopsysçš„ipï¼Œæˆ‘åœ¨éå¸¸å¤šçš„SOCä¸­éƒ½è§è¿‡è¿™ä¸ªæ§åˆ¶å™¨ã€‚é˜…è¯»ä»£ç çœ‹åˆ°è¿™ä¸ªdwc3ä»¿çœŸä¼¼ä¹æ˜¯Xilinxå†™çš„ï¼Œè¢«åŒ…å«åœ¨xlnx-usb-subsystemä¸­ä¸€éƒ¨åˆ†ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸ä½¿ç”¨XILINX_VERSALçš„ä»£ç ï¼Œç›´æ¥åˆ›å»ºä¸€ä¸ªdwc3è®¾å¤‡ã€‚ä»£ç è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œå¦‚ä¸‹ï¼š

    ```c
    static void quard_star_usbs_create(MachineState *machine)
    {
        QuardStarState *s = RISCV_VIRT_MACHINE(machine);
    
        object_initialize_child(OBJECT(s), "dwc3", &s->usb,
                                TYPE_USB_DWC3);
    
        sysbus_realize(SYS_BUS_DEVICE(&s->usb), &error_fatal);
    
        sysbus_mmio_map(SYS_BUS_DEVICE(&s->usb), 0, 
                                virt_memmap[QUARD_STAR_USB].base);
        qdev_pass_gpios(DEVICE(&s->usb.sysbus_xhci), DEVICE(&s->usb), SYSBUS_DEVICE_GPIO_IRQ);
        sysbus_connect_irq(SYS_BUS_DEVICE(&s->usb), 0,
                        qdev_get_gpio_in(DEVICE(s->plic), QUARD_STAR_USB_IRQ));
    }
    ```

    ç¼–å†™è®¾å¤‡æ ‘æ–‡ä»¶ï¼Œç„¶åé…ç½®å†…æ ¸CONFIG_USB_DWC3=yï¼Œè¿è¡Œï¼Œè¿™é‡Œå±…ç„¶å‡ºç°äº†oopsï¼Œçœ‹èµ·æ¥æ˜¯è®¿é—®å¼‚å¸¸ï¼Œéš¾é“è¯´éƒ¨åˆ†å¯„å­˜å™¨æ²¡å®ç°å¯¼è‡´è¯»å†™å‡ºé”™äº†å—ï¼Ÿç¿»çœ‹äº†ä»£ç qemu-6.0.0/hw/usb/hcd-dwc3.c:587è¿™è¾¹æ¨¡æ‹Ÿå™¨æ˜¯register_read_memory/register_write_memoryæ¥è®¿é—®å¯„å­˜å™¨çš„ï¼Œqemuå’Œå†…æ ¸ä¸¤å¤´åŠ æ‰“å°ï¼Œæœ€ç»ˆå®šä½åˆ°æ˜¯å†…æ ¸linux-5.10.65/drivers/usb/dwc3/core.c:290è¿™é‡Œè®¿é—®DWC3_DCTLå‡ºé”™ï¼Œå…¶å®é—®é¢˜å¾ˆæ˜ç¡®ï¼Œqemuæ³¨é‡Šå†™æ˜äº†åªæ”¯æŒhostå› æ­¤deviceç›¸å…³çš„å¯„å­˜å™¨éƒ½æ˜¯æ²¡æœ‰å®ç°çš„ï¼Œé‚£ä¹ˆå†…æ ¸é‡Œçš„é©±åŠ¨ä¸ºä»€ä¹ˆè¿˜è®¿é—®è®¾å¤‡å¯„å­˜å™¨å‘¢ï¼Œæ¯•ç«Ÿæˆ‘ä»¬åœ¨è®¾å¤‡æ ‘é‡ŒæŒ‡å®šäº†dr_modeä¸ºhostï¼Œæœ€ç»ˆä¿®æ”¹283è¡Œåˆ¤æ–­ä»£ç æ·»åŠ å¦ä¸€ä¸ªæ¡ä»¶æ£€æŸ¥dr_modeæ¥è·³è¿‡deviceå¯„å­˜å™¨ã€‚è€ƒè™‘Xilinxè‡ªå·±çš„é©±åŠ¨ä»£ç æ˜¯5.13æ‰åŠ å…¥å†…æ ¸ä¸»çº¿çš„ï¼Œå› æ­¤æŸ¥äº†ä¸‹æœ€æ–°çš„å†…æ ¸5.15çš„é©±åŠ¨ä»£ç æœ‰æ‰€å˜åŒ–ï¼Œä½†è¿™ä¸ªåˆ¤æ–­æ¡ä»¶ä»æ²¡æœ‰ä¿®æ”¹ï¼Œæ˜¯å¦ä¿®å¤äº†çœ‹ä¸å‡ºæ¥ï¼Œè¿™é‡Œå°±å…ˆæš‚ä¸”æ”¾ä¸‹ï¼Œå…ˆæŒ‰æˆ‘è¿™ä¸ªä¿®æ”¹ä½¿ç”¨ã€‚

    ```c
    if (dwc->current_dr_role == DWC3_GCTL_PRTCAP_HOST ||
        dwc->dr_mode == USB_DR_MODE_HOST)
    return 0;
    ```

    æå®šä¹‹åè¿›å…¥ç³»ç»Ÿä¸€åˆ‡é¡ºåˆ©ï¼Œä½¿ç”¨lsusbå¯ä»¥çœ‹åˆ°æ§åˆ¶å™¨ä¿¡æ¯ã€‚

    ```
    [~]#lsusb 
    Bus 001 Device 001: ID 1d6b:0002
    Bus 002 Device 001: ID 1d6b:0003
    ```

- 
    2021.11.07(ä¸Šåˆ):æ·»åŠ äº†gpioå’Œdmaæ§åˆ¶å™¨ï¼Œæ¯”è¾ƒç®€å•å¥½ç†è§£çš„æ§åˆ¶å™¨ã€‚
- 
    2021.11.07(ä¸‹åˆ):æ·»åŠ äº†sdmmcæ§åˆ¶å™¨ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥æœ‰sdå¡äº†ã€‚
- 
    2021.11.14(ä¸‹åˆ):è¿™å‘¨æ²¡æ€ä¹ˆå¼€å‘è¿™ä¸ªé¡¹ç›®ï¼Œå› ä¸ºRæ˜Ÿå‘å¸ƒäº†GTAä¸‰éƒ¨æ›²æœ€ç»ˆç‰ˆï¼Œç«¥å¹´ç»å…¸æ¸¸æˆï¼Œæ‰€ä»¥æœæ–­å›å‘³ç»å…¸å»äº†ã€‚ä¸è¿‡è¿˜æ˜¯æœ‰è¿›åº¦çš„ï¼Œè®¡åˆ’ç»™è¿™ä¸ªé¡¹ç›®åšä¸€ä¸ªmaskromæ·»åŠ å¤šç§bootæ–¹å¼å’Œå‡çº§å›ºä»¶çš„åŠŸèƒ½ï¼Œå› æ­¤åˆæ­¥å®Œæˆäº†sysconçš„è®¾è®¡ï¼Œæ·»åŠ äº†ä¸€ä¸ªbootçŠ¶æ€å¯„å­˜å™¨ï¼Œå¯ä»¥é€šè¿‡qemuå‚æ•°æŒ‡å®šbootçŠ¶æ€ã€‚ç¨æ™šç‚¹æŠŠä»£ç æ•´ç†å¥½æäº¤ã€‚
- 
    2021.11.19(æ™šä¸Š):æŠŠmaskromä¸­pflash/spi/sdä¸‰ç§bootçš„ä»£ç å®Œæˆäº†ï¼Œè¿™é‡Œè¦å¼ºè°ƒä¸‹maskromä¸­çš„spiå’Œsdhciçš„é©±åŠ¨ç¼–å†™çš„éå¸¸ç®€å•è€Œç²—ç³™ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Œå› ä¸ºæˆ‘ä»¬è¦ç®€åŒ–maskromçš„ä»£ç è®¾è®¡ï¼Œå°½å¯èƒ½ä½¿ç”¨æå°‘çš„romå’Œramç©ºé—´ï¼ŒçœŸå®çš„socè®¾è®¡æ—¶è¿™äº›é™æ€ramçš„æˆæœ¬æ˜¯å¾ˆé«˜çš„ï¼Œå½“ç„¶è¿™ä»½é©±åŠ¨ä»£ç è¿˜è¦è€ƒè™‘æ›´å¤šæ€§èƒ½å’Œå…¼å®¹æ€§çš„é—®é¢˜ï¼Œè¿™é‡Œæˆ‘ä»¬æ²¡æœ‰ä»”ç»†æ–Ÿé…Œï¼Œä»…ä½œç¤ºä¾‹ï¼ˆè¿™é‡Œå‘ç°äº†ä¸ªå¥‡æ€ªçš„ç°è±¡ï¼Œspiçš„é©±åŠ¨åœ¨maskromå’ŒlowlevelbootçŠ¶æ€ä¸‹æ€§èƒ½å·®å¼‚å¾ˆå¤§ï¼Œè¿™å¯èƒ½æ˜¯qemuçš„é—®é¢˜ï¼Œåç»­æœ‰ç©ºç ”ç©¶ä¸‹ï¼‰ã€‚lowlevelbootä»£ç å¢åŠ äº†spiå’Œsdçš„æƒ…å†µï¼Œè¿™é‡Œæ³¨æ„ä¸‹ä»£ç æ”¹ä¸ºåœ¨sramçš„åœ°å€ç©ºé—´æ‰§è¡Œï¼Œä½†æ˜¯ä¹‹å‰pflashçš„ä»£ç å› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº†çº¯æ±‡ç¼–ç¼–å†™ï¼Œå› æ­¤åœ°å€æ˜¯æ— å…³çš„ï¼Œé™¤äº†ä¸€ä¸ª_penå˜é‡çš„å–å€æ–¹å¼æ˜¯éœ€è¦pcï¼Œè¿™è¾¹ç‰¹æ®Šå¤„ç†ä¸‹å³å¯ï¼Œè¿™æ ·æˆ‘ä»¬çš„lowlevelbootä»£ç å°±å¯ä»¥åœ¨pflashå’Œsarmä¸¤ç§æ–¹å¼éƒ½èƒ½æ‰§è¡Œæ­£ç¡®äº†ã€‚ç°åœ¨maskromä»£ç å°±åªå·®å‡çº§åŠŸèƒ½æ²¡å®Œæˆäº†ï¼Œè¿™é‡Œæˆ‘è®¡åˆ’ä½¿ç”¨xmodemåè®®ï¼Œå¦å¤–è®¡åˆ’å†å†™ä¸ªPCå‡çº§å·¥å…·ç”¨äºé…åˆå‡çº§æµç¨‹ã€‚å¦å¤–åˆæ•´ç†äº†ä¸€äº›æ¡†å›¾æµç¨‹å›¾ã€‚
- 
    2021.11.20(æ—©ä¸Š):ç§»æ¤xmodemä¼ è¾“åè®®åˆ°mask_romï¼ŒæˆåŠŸæµ‹è¯•å¯ä»¥é€šè¿‡uartçƒ§å†™lowlevelboot.binåˆ°sramå†…ï¼Œéœ€è¦åšä¸€ä¸ªå¥½ç”¨çš„pcå·¥å…·æ¥å¯¹æ¥å‡çº§ï¼Œè®¡åˆ’è€ƒè™‘ç”¨pyqtæˆ–è€…Qtæ¥å†™ã€‚
- 
    2021.11.21(æ™šä¸Š):ä¼˜åŒ–ä»£ç ï¼Œæ·»åŠ CIæ¥å¯¹uartå‡çº§åŠŸèƒ½è¿›è¡Œæµ‹è¯•ï¼Œä½†æ˜¯CIé—®é¢˜å¾ˆå¤šï¼Œcondaçš„ç¯å¢ƒæ€»æ˜¯æœ‰é—®é¢˜ï¼Œå¥½åœ¨ç»ˆäºè§£å†³äº†ï¼Œè€Œä¸”æŠŠä¹‹å‰çš„CIè„šæœ¬åšäº†æ›´æ–°ï¼Œç°åœ¨ä»£ç æ›´åŠ å¹²å‡€æ•´æ´äº†ã€‚å¦å¤–ï¼Œæˆ‘ä»Šå¤©å¿ƒæƒ…ç‰¹åˆ«ç³Ÿç³•ï¼Œç‰¹åˆ«ç³Ÿç³•ï¼Œç‰¹åˆ«ç³Ÿç³•ï¼Œç‰¹åˆ«ç³Ÿç³•ï¼Œç‰¹åˆ«ç³Ÿç³•ï¼Œç‰¹åˆ«ç³Ÿç³•ï¼Œç‰¹åˆ«ç³Ÿç³•ï¼Œç‰¹åˆ«ç³Ÿç³•ï¼Œç‰¹åˆ«ç³Ÿç³•ï¼Œç‰¹åˆ«ç³Ÿç³•ï¼Œç‰¹åˆ«ç³Ÿç³•ï¼Œç‰¹åˆ«ç³Ÿç³•ï¼Œç‰¹åˆ«ç³Ÿç³•ï¼Œç‰¹åˆ«ç³Ÿç³•ï¼Œç‰¹åˆ«ç³Ÿç³•ã€‚æˆ‘æƒ³æˆ‘æ˜¯å¦åº”è¯¥å»çœ‹å¿ƒç†åŒ»ç”Ÿäº†ã€‚å“­ã€‚
- 
    2021.11.22(æ™šä¸Š):çŠ¶æ€æ¢å¤äº†ï¼Œå¿ƒæƒ…å¾ˆå¥½å¾ˆå¼€å¿ƒï¼Œæ˜¯çš„ï¼Œæˆ‘ç°åœ¨æƒ…ç»ªæ³¢åŠ¨çœŸçš„å¾ˆå¤§ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“è¯¥æ€ä¹ˆå¤„ç†ã€‚å¥½äº†èŠæ­£äº‹ï¼Œå¿ƒæƒ…ä¸é”™ï¼Œä»Šå¤©æŠ½ç©ºç ”ç©¶ä¸‹ä¸ºä»€ä¹ˆä¹‹å‰å†™çš„spi flashçš„é©±åŠ¨åœ¨maskromä¸Šè¿è¡ŒåŠå…¶æ…¢ï¼Œè€Œè¿›å…¥lowlevelbooté˜¶æ®µåˆ™ä¸ä¼šè¿è¡Œé‚£ä¹ˆæ…¢äº†ï¼Œè™½ç„¶ä½œä¸ºç¤ºä¾‹é©±åŠ¨å®ç°çš„å†™æ³•ä¸ºä½æ•ˆç‡çš„è½®å¯»ï¼Œä½†ä¹Ÿä¸åº”è¯¥åœ¨ä¸åŒé˜¶æ®µæ‰§è¡Œé€Ÿåº¦ä¸ä¸€æ ·ï¼Œè¿™é‡Œæ€€ç–‘æ˜¯qemuæœ¬èº«å®ç°çš„é—®é¢˜ã€‚é¦–å…ˆqemuæ˜¯æ‹¥æœ‰ä¸€ä¸ªtcgå­ç³»ç»Ÿï¼Œç”¨äºå°†guestæŒ‡ä»¤è½¬æ¢ä¸ºhostä¸Šçš„æŒ‡ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥ä»è¿™é‡Œå…¥æ‰‹ï¼Œé¦–å…ˆè¿è¡Œqemuæ—¶æ·»åŠ å‚æ•°-d op -D qemu.logï¼Œè¿™æ ·ä¼šå°†è¿è¡Œäº§ç”Ÿçš„tcgä¸­é—´IRç æ‰“å°å‡ºæ¥ï¼Œå¦‚ä¸‹ç¤ºä¾‹:

    ```
    OP:
        ld_i32 tmp0,env,$0xfffffffffffffff0
        brcond_i32 tmp0,$0x0,lt,$L0

        ---- 0000000000000000
        mov_i32 tmp0,$0x1
        st_i32 tmp0,env,$0xfffffffffffff168
        mov_i64 x3/gp,$0xe2000
        goto_tb $0x0
        mov_i64 pc,$0x4
        exit_tb $0x7fe43effe000
        set_label $L0
        exit_tb $0x7fe43effe003
    
    â€¦â€¦â€¦â€¦
    ```

    å¥½å˜›ï¼Œè¿™ä¸€çœ‹æ‰å‘ç°ï¼Œåœ¨maskromé˜¶æ®µæ‰§è¡Œçš„IRç çš„ç¿»è¯‘éƒ½æ˜¯ä¸€æ¡ä¸€æ¡å•æŒ‡ä»¤ç¿»è¯‘çš„ï¼Œè€Œåˆ°lowlevelbooté˜¶æ®µåˆ™æ˜¯æŒ‰ç…§TBå—ç¿»è¯‘çš„ï¼Œéš¾æ€ªä»¿çœŸæ•ˆç‡å·®è¿™ä¹ˆå¤šï¼Œè¿™çœ‹èµ·æ¥åƒæ˜¯bugï¼Œæˆ‘ä»¬æ¥è¿½è¸ªä¸‹qemuæºç çœ‹ä¸‹ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿè¿™ç§ç°è±¡ã€‚é¦–å…ˆæ‰¾åˆ°ï¼šqemu-6.0.0/accel/tcg/translate-all.c:1862ï¼Œä»£ç ç‰‡æ®µï¼š

    ```c
    phys_pc = get_page_addr_code(env, pc);

    if (phys_pc == -1) {
        /* Generate a one-shot TB with 1 insn in it */
        //QQM mark
        cflags = (cflags & ~CF_COUNT_MASK) | CF_LAST_IO | 1;
    }
    ```

    è¿™é‡Œå¦‚æœphys_pcä¸º-1,åˆ™TBå—çš„å¤§å°ä¸º1,å®æµ‹æœç„¶æ˜¯è¿™é‡Œä¸º-1äº†ï¼Œè€Œæˆ‘ä»¬çš„pcåœ°å€åœ¨maskromé˜¶æ®µæ˜¯0åœ°å€å¼€å§‹çš„ï¼Œç»§ç»­è¿½è¸ªä»£ç åˆ°qemu-6.0.0/accel/tcg/cputlb.c:1518ï¼Œå‡½æ•°get_page_addr_code_hostpä¸­ä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š

    ```c
    if (unlikely(!tlb_hit(entry->addr_code, addr))) {
        if (!VICTIM_TLB_HIT(addr_code, addr)) {
            tlb_fill(env_cpu(env), addr, 0, MMU_INST_FETCH, mmu_idx, 0);
            index = tlb_index(env, mmu_idx, addr);
            entry = tlb_entry(env, mmu_idx, addr);

            if (unlikely(entry->addr_code & TLB_INVALID_MASK)) {
                /*
                 * The MMU protection covers a smaller range than a target
                 * page, so we must redo the MMU check for every insn.
                 */
                return -1;
            }
        }
        assert(tlb_hit(entry->addr_code, addr));
    }
    ```
    
    è¿™é‡Œæ¡ä»¶entry->addr_code & TLB_INVALID_MASKä¸ºçœŸï¼Œè¿™é‡Œéå¸¸æœ‰é—®é¢˜ï¼Œä¸ºä»€ä¹ˆ0åœ°å€åœ¨ä¸Šç”µçŠ¶æ€ä¸‹TLB_INVALID_MASKï¼Œå…¶ä»–åœ°å€å°±æ²¡è¿™ä¸ªé—®é¢˜ï¼Œç»§ç»­è·Ÿè¸ªå‘ç°å‡½æ•°tlb_set_page_with_attrsä¸­ä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š

    ```
    if (size < TARGET_PAGE_SIZE) {
        /* Repeat the MMU check and TLB fill on every access.  */
        address |= TLB_INVALID_MASK;
    }
    ```

    å‘ä¸Šè¿½è¸ªæ­¤å¤„çš„å¼‚å¸¸sizeæ¥æºäºtlb_set_pageï¼Œè€Œé’ˆå¯¹RISCVå¹³å°çš„è°ƒç”¨åœ¨å‘ç”Ÿåœ¨qemu-6.0.0/target/riscv/cpu_helper.cæ–‡ä»¶å†…riscv_cpu_tlb_fillå‡½æ•°å†…é€šè¿‡get_physical_address_pmpè·å–tlb_sizeåä¼ é€’ç»™tlb_set_pageï¼Œåˆ°è¿™é‡Œå°±è¿›å…¥åˆ°riscvçš„å¹³å°ä¸“æœ‰ä»£ç çš„ï¼Œçœ‹æ¥è·ç¦»çœŸç›¸æ¥è¿‘äº†ã€‚ç»§ç»­è¿½è¸ªä»£ç å‘ç°åœ¨qemu-6.0.0/target/riscv/pmp.cæ–‡ä»¶å†…çš„pmp_is_range_in_tlb-->pmp_get_tlb_sizeå‡½æ•°tlb_saåœ¨ç¬¬ä¸€ä¸ª4KåŒºåŸŸå†…ï¼Œä¼šè¿”å›1è¿™ä¸ªsizeã€‚

    ```c
    static target_ulong pmp_get_tlb_size(CPURISCVState *env, int pmp_index,
                                        target_ulong tlb_sa, target_ulong tlb_ea)
    {
        target_ulong pmp_sa = env->pmp_state.addr[pmp_index].sa;
        target_ulong pmp_ea = env->pmp_state.addr[pmp_index].ea;

        if (pmp_sa >= tlb_sa && pmp_ea <= tlb_ea) {
            //printf("1 %ld %ld %ld %ld\n",pmp_sa,tlb_sa,pmp_ea,tlb_ea);
            return pmp_ea - pmp_sa + 1;
        }

        if (pmp_sa >= tlb_sa && pmp_sa <= tlb_ea && pmp_ea >= tlb_ea) {
            return tlb_ea - pmp_sa + 1;
        }

        if (pmp_ea <= tlb_ea && pmp_ea >= tlb_sa && pmp_sa <= tlb_sa) {
            return pmp_ea - tlb_sa + 1;
        }

        return 0;
    }
    ```

    è¿™é‡Œçš„é—®é¢˜å°±æ˜¯env->pmp_state.addr\[pmp_index\].saå’Œenv->pmp_state.addr\[pmp_index\].eaéƒ½ç­‰äº0,è€Œä»£ç è¿è¡Œåœ¨è¿™é‡Œæ—¶ï¼Œpmp_stateæ ¹æœ¬å°±æ²¡æœ‰åšä»»ä½•é…ç½®ï¼Œsaå’Œeaéƒ½æ˜¯å†…å­˜allocåçš„é»˜è®¤å€¼ï¼Œé˜…è¯»pmp_update_rule_addrå®ç°ä¸éš¾å‘ç°ï¼Œä¸Šç”µçŠ¶æ€ä¸‹pmpæ¨¡å—åº”è¯¥ä¸ºPMP_AMATCH_OFFçŠ¶æ€saåº”ä¸º0,eaåº”ä¸ºæœ€å¤§å€¼ï¼Œè¿™æ ·ä¹‹å‰çš„pmp_is_range_in_tlbå°±ä¸ä¼šè¿”å›é‚£ä¸ªå¥‡æ€ªçš„1å€¼äº†ã€‚è¿™é‡Œæ˜¾ç„¶æ˜¯ä¸ªä¸¥é‡é—®é¢˜ï¼Œgueståœ¨æœªåˆå§‹é…ç½®pmpæ—¶ï¼Œtlb_sizeè·å–é”™è¯¯ã€‚

    ```c
    void pmp_update_rule_addr(CPURISCVState *env, uint32_t pmp_index)
    {
        uint8_t this_cfg = env->pmp_state.pmp[pmp_index].cfg_reg;
        target_ulong this_addr = env->pmp_state.pmp[pmp_index].addr_reg;
        target_ulong prev_addr = 0u;
        target_ulong sa = 0u;
        target_ulong ea = 0u;

        if (pmp_index >= 1u) {
            prev_addr = env->pmp_state.pmp[pmp_index - 1].addr_reg;
        }

        switch (pmp_get_a_field(this_cfg)) {
        case PMP_AMATCH_OFF:
            sa = 0u;
            ea = -1;
            break;

        case PMP_AMATCH_TOR:
            sa = prev_addr << 2; /* shift up from [xx:0] to [xx+2:2] */
            ea = (this_addr << 2) - 1u;
            break;

        case PMP_AMATCH_NA4:
            sa = this_addr << 2; /* shift up from [xx:0] to [xx+2:2] */
            ea = (sa + 4u) - 1u;
            break;

        case PMP_AMATCH_NAPOT:
            pmp_decode_napot(this_addr, &sa, &ea);
            break;

        default:
            sa = 0u;
            ea = 0u;
            break;
        }

        env->pmp_state.addr[pmp_index].sa = sa;
        env->pmp_state.addr[pmp_index].ea = ea;
    }
    ```

    ç”±äºè¿™éƒ¨åˆ†ä»£ç é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œç›®å‰æˆ‘è¿˜æ²¡æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„åœ°æ–¹æ·»åŠ å¯¹pmp_state.addråˆå€¼çš„initï¼Œæ‰€ä»¥ï¼Œç›®å‰æˆ‘çš„è§£å†³åŠæ³•æ˜¯åœ¨maskromä»£ç å†…ä¸€å¼€å§‹çš„ä½ç½®æ·»åŠ 

    ```asm
    csrw pmpcfg0, 0
  	csrw pmpcfg1, 0
  	csrw pmpcfg2, 0
  	csrw pmpcfg3, 0
    ```

    ä»¥æ­¤å°†pmpé…ç½®åˆ°æ­£ç¡®çš„åˆå§‹å€¼ï¼Œä¿®æ”¹å’Œå†æ¬¡æµ‹è¯•spi flashçš„é©±åŠ¨ï¼Œæœç„¶é—®é¢˜è§£å†³ã€‚æœ€åqemuçš„tcgéå¸¸æœ‰æ„æ€ï¼Œè¿™é‡Œæ¨èä¸€äº›[åšå®¢](https://airbus-seclab.github.io/qemu_blog/tcg_p1.html)ç»™å¤§å®¶ï¼Œæ„Ÿå…´è¶£å¯ä»¥é˜…è¯»ã€‚
- 
    2021.12.04(å‡Œæ™¨):ç›®å‰é¡¹ç›®åŠŸèƒ½æ·»åŠ çš„å·®ä¸å¤šäº†ï¼Œæ²¡æœ‰å¤ªå¤šæƒ³æ³•ï¼Œåªå·®äº›ç»†èŠ‚ä¼˜åŒ–å¯ä»¥æ…¢æ…¢æ¥åšã€‚ç„¶åè¿™ä¸¤å¤©çªå‘å¥‡æƒ³æƒ³ç»™è¿™ä¸ªé¡¹ç›®åšä¸ªæ¼‚äº®çš„GUIå‰ç«¯ï¼Œä»¥ä¸€å—å¼€å‘æ¿çš„å½¢å¼å±•ç°å‡ºæ¥ï¼Œå¯ä»¥ç‚¹å‡»å¼€å‘æ¿ä¸Šçš„å¼€å…³å¯åŠ¨qemuï¼Œå¹¶ä¸”ç‚¹å‡»ä¸²å£ï¼Œvgaæ¥å£æ¥æŸ¥çœ‹ä»¿çœŸçš„è¾“å‡ºï¼Œç‚¹å‡»flashå™¨ä»¶åŠ è½½å›ºä»¶ç­‰ç­‰ï¼Œè™½è¯´æŠ€æœ¯ä»·å€¼ä¸å¤§ï¼Œä½†æ˜¯å¾ˆå¥½ç©å¾ˆæœ‰è¶£å°±å¥½äº†ã€‚ç»è¿‡ä¸€å¤©çš„åŠªåŠ›ï¼Œç»ˆäºè‚åˆ°å‡Œæ™¨è¿™ä¸ªå·¥å…·åˆå…·å½¢æ€äº†ã€‚æˆ‘æ¥å½•åˆ¶ä¸ªgifç»™å¤§å®¶çœ‹çœ‹ã€‚

    ![img7](./tutorial/img/img7.gif)

- 
    2021.12.05(æ™šä¸Š):guiå‰ç«¯toolsä¿®ä¿®ä»£ç é£æ ¼ï¼Œæ·»åŠ å‘½ä»¤è¡Œé€‰é¡¹ï¼Œæ›´æ–°ä¸»ç•Œé¢é‡Œä¸ç¾è§‚çš„å»ºæ¨¡ï¼Œè¿™é‡Œç‰¹åˆ«é¸£è°¢[MignonZhu](https://github.com/MignonZhu)æä¾›3Dæ¨¡å‹çš„ï¼Œè®©UIå˜çš„æ›´åŠ å¥½çœ‹ã€‚å¦å¤–GIMPæˆ‘ç°åœ¨ä½¿ç”¨ç›¸å½“ç†Ÿç»ƒäº†ï¼Œå®Œå…¨ä¸è¾“PSï¼Œç”šè‡³æ›´å¥½ã€‚
- 
    2021.12.18(ä¸‹åˆ):æœ€è¿‘ä¸Šç­æœ‰ç‚¹å¿™ï¼Œå¼€å§‹æ²¡æ—¶é—´æè¿™ä¸ªäº†ã€‚ä¸‰å¤©å‰æˆ‘åº¦è¿‡äº†æœ€å­¤å•çš„ä¸€æ¬¡ç”Ÿæ—¥ï¼Œ26å‘¨å²çš„æˆ‘çœŸçš„å¯¹ç”Ÿå‘½è¶Šæ¥è¶Šææƒšäº†ï¼Œä¸çŸ¥é“è‡ªå·±è¿˜ä¼šå•çº¯å–„è‰¯åˆ°ä½•æ—¶ï¼Œä¹Ÿä¸çŸ¥é“æœªæ¥ç©¶ç«Ÿåœ¨ä½•æ–¹ï¼Œä¸è¿‡å¦‚ä»Šçš„æˆ‘å·²ç„¶éº»æœ¨ä¸å†å¥¢æ±‚ä»€ä¹ˆï¼Œæ­¤ç”Ÿå°±å®ˆç€å¿ƒä¸­çš„ç™½æœˆå…‰åˆ°æ°¸è¿œå§ã€‚å›åˆ°å¼€å‘è®¡åˆ’ï¼šæœ¬æ¥è®¡åˆ’æ·»åŠ ä¸€ä¸ªaudio playçš„ç³»ç»Ÿï¼Œç›®å‰æ·»åŠ äº†i2sæ§åˆ¶å™¨å’Œwm8750 codecï¼Œä½†æ˜¯å†…æ ¸çš„é©±åŠ¨æ²¡æœ‰ç°æˆäº†å¾—è‡ªå·±å†™ï¼Œç›®å‰æ¡†æ¶å†™å¥½äº†ï¼Œä½†æ˜¯qemuè¿™è¾¹å‘ç°ä¸»æœºpulseaudioåº•å±‚ä¹Ÿæœ‰ç‚¹é—®é¢˜ï¼Œä¸æ˜¯å¾ˆæœ‰ç©ºè°ƒè¯•ï¼Œå…ˆæš‚æ—¶è®¾å¤‡æ ‘å†™disabledæäº¤äº†ä»£ç ã€‚
- 
    2022.04.19(æ™šä¸Š):qemuæœ€æ–°çš„7.0.0ç‰ˆæœ¬åœ¨ä»Šå¤©å¦‚æœŸå‘å¸ƒäº†ï¼Œè¿˜æ˜¯å¸¦æ¥äº†å¾ˆå¤šriscvç›¸å…³çš„æ›´æ–°ï¼ŒåŒ…æ‹¬rvvã€rvhæ‰©å±•ï¼Œæ”¯æŒäº†kvmï¼Œæˆ‘ä»¬å°±ç¬¬ä¸€æ—¶é—´å°†quard-starçš„å®ç°å‘7.0.0ç‰ˆæœ¬ç§»æ¤ï¼ŒAPIæ–¹é¢æ”¹åŠ¨å¹¶ä¸å¤šï¼Œä¸»è¦æ˜¯ä¸ºäº†kvmæ”¯æŒæ·»åŠ äº†æ›´æ ‡å‡†rvclintå’Œrvplicï¼Œè¿™è¾¹æˆ‘ä»¬å…ˆæš‚æ—¶ä¸å®ç°kvmæ”¯æŒï¼Œå…ˆè®©åŸåŠŸèƒ½å…¨éƒ¨è·‘é€šï¼Œç­‰åé¢å‘¨æœ«æˆ‘æœ‰ç©ºå†æ¥è¿›è¡Œä»£ç ä¼˜åŒ–ã€‚å¦å¤–æˆ‘ä¹‹å‰æåˆ°çš„pmp_state.addråˆå€¼çš„inité—®é¢˜å®˜æ–¹å·²ç»è§£å†³äº†ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ é™¤ä¹‹å‰mask_romä¸­çš„csrw pmpcfg0, 0ç›¸å…³ä»£ç äº†ã€‚ç§»æ¤å®Œæˆæµ‹è¯•å‘ç°freertosç›¸å…³ä»£ç åœ¨cpu7ä¸­è¿è¡Œåˆ°ä¸­é€”å‡ºç°äº†æ— æ³•ç»§ç»­è°ƒåº¦çš„é—®é¢˜ï¼Œè¿™ä¸ªæš‚æ—¶æŒ‚èµ·ç­‰å¾…åé¢æŠ½ç©ºç ”ç©¶ã€‚
- 
    2022.04.23(æ™šä¸Š):æé”™äº†ï¼Œfreertosç›¸å…³ä»£ç åœ¨cpu7ä¸­è¿è¡Œåˆ°ä¸­é€”å‡ºç°äº†æ— æ³•ç»§ç»­è°ƒåº¦çš„é—®é¢˜æ˜¯ç”±äºä¹‹å‰ä¸€æ¬¡ä¿®æ”¹è®¾å¤‡æ ‘æ—¶æ²¡æœ‰é…ç½®å¥½ä¿ç•™å†…å­˜åŒºåŸŸå¯¼è‡´linuxå¯åŠ¨åè¦†ç›–äº†cpu7éœ€è¦çš„å†…å­˜ç©ºé—´å¯¼è‡´çš„ï¼Œç›®å‰é—®é¢˜å·²è§£å†³ã€‚
- 
    2022.06.05(ä¸‹åˆ):æ·»åŠ äº†onenand ipç”¨äºå­¦ä¹ nand falshç›¸å…³å†…å®¹ï¼Œä»¥åŠubifsï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªæ¨¡å‹qemu-7.0.0/hw/block/onenand.cï¼Œæ·»åŠ åˆ°æˆ‘ä»¬çš„quard star socä¸­ï¼Œå¦å¤–æ³¨æ„è¯¥ipçš„å¯„å­˜å™¨ç©ºé—´sizeä¸º0x20000ã€‚è¿™é‡Œè¦æ³¨æ„ä¸‹ï¼Œæ¨¡æ‹Ÿçš„flashå¤§å°ä¸º256Mï¼Œä½†æ˜¯è¿è¡Œæ—¶ä½¿ç”¨-drive if=mtd,bus=1,unit=0,format=raw,file=$SHELL_FOLDER/output/fw/nandflash.img,id=mtd2è¿™ä¸ªæä¾›çš„æ–‡ä»¶æ˜ åƒåº”ä¸º264Mï¼Œå› ä¸ºé©±åŠ¨å†…ä¼šä½¿ç”¨æœ€å8Mçš„å¤‡ç”¨åŒºç©ºé—´æ¥å­˜å‚¨åå¿«è¡¨ç­‰ä¿¡æ¯ã€‚
- 
    2022.06.08(æ™šä¸Š):æ·»åŠ äº†xlnx-can ipï¼ŒåŸºæœ¬æ²¡æœ‰é‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Œä¸è¿‡åœ¨æµ‹è¯•hostä¸Šä½¿ç”¨vcanä¸guestä¸Šçš„cané€šä¿¡ï¼Œç»“æœå‘ç°æ•°æ®åŒ…å­—èŠ‚åºä¼¼ä¹ä¸æ­£ç¡®ï¼Œå› æ­¤å¯¹æ¯”kernelå†…çš„é©±åŠ¨ä»£ç ä»¥åŠqemuçš„ä»£ç å‘ç°xlnxçš„canæ ¼å¼å’Œsocket canæ ¼å¼æ˜¯ä¸åŒ¹é…çš„ï¼Œéœ€è¦è½¬æ¢ï¼Œè¿™é‡Œé˜…è¯»ã€Šug1085-zynq-ultrascale-trm.pdfã€‹çš„Table 20â€3: CAN Message Formatå°±èƒ½å‘ç°è¿™ä¸ªé—®é¢˜ï¼Œå¥‡æ€ªçš„æ˜¯qemu-7.0.0/hw/net/can/xlnx-zynqmp-can.cå†…å®ç°çš„ä¼¼ä¹æ²¡æœ‰è½¬æ¢xlnx CAN Message Formatè€Œæ˜¯æŠŠSocket CAN Formatç›´æ¥è½¬å‘äº†ï¼Œå› æ­¤å¯¼è‡´äº†é”™è¯¯ã€‚æˆ‘è¿™é‡Œæ·»åŠ æˆ–ä¿®æ”¹ä»¥ä¸‹å‡½æ•°ï¼Œé—®é¢˜å¾—åˆ°è§£å†³ï¼ˆè¿™é‡Œæˆ‘æ²¡æœ‰å‘qemuä¸Šæ¸¸å‘é€patchï¼Œå› ä¸ºæˆ‘ä¸ç¡®å®šæ˜¯å¦çœŸå®çš„zynqä¹Ÿå­˜åœ¨è¯¥é—®é¢˜ï¼‰ï¼š

    ```c
    #define XCAN_IDR_IDE_MASK		0x00080000U
    #define XCAN_IDR_ID1_MASK		0xFFE00000U
    #define XCAN_IDR_ID2_MASK		0x0007FFFEU
    #define XCAN_IDR_RTR_MASK		0x00000001U
    #define XCAN_IDR_SRR_MASK		0x00100000U
    #define XCAN_IDR_ID1_SHIFT		21
    #define XCAN_IDR_ID2_SHIFT		1
    #define CAN_SFF_ID_BITS		    11
    #define CAN_EFF_ID_BITS		    29
    
    static uint32_t id_xcan2can(uint32_t id)
    {
        uint32_t ret_id = 0; 
        /* Change Xilinx CAN ID format to socketCAN ID format */
        if (id & XCAN_IDR_IDE_MASK) {
            /* The received frame is an Extended format frame */
            ret_id = (id & XCAN_IDR_ID1_MASK) >> 3;
            ret_id |= (id & XCAN_IDR_ID2_MASK) >>
                    XCAN_IDR_ID2_SHIFT;
            ret_id |= QEMU_CAN_EFF_FLAG;
            if (id & XCAN_IDR_RTR_MASK)
                ret_id |= QEMU_CAN_RTR_FLAG;
        } else {
            /* The received frame is a standard format frame */
            ret_id = (id & XCAN_IDR_ID1_MASK) >>
                    XCAN_IDR_ID1_SHIFT;
            if (id & XCAN_IDR_SRR_MASK)
                ret_id |= QEMU_CAN_RTR_FLAG;
        }
        return ret_id;
    }

    static uint32_t id_can2xcan(uint32_t id)
    {
        uint32_t ret_id = 0;
        if (id & QEMU_CAN_EFF_FLAG) {
            /* Extended CAN ID format */
            ret_id = ((id & QEMU_CAN_EFF_MASK) << XCAN_IDR_ID2_SHIFT) &
                XCAN_IDR_ID2_MASK;
            ret_id |= (((id & QEMU_CAN_EFF_MASK) >>
                (CAN_EFF_ID_BITS - CAN_SFF_ID_BITS)) <<
                XCAN_IDR_ID1_SHIFT) & XCAN_IDR_ID1_MASK;
            ret_id |= XCAN_IDR_IDE_MASK | XCAN_IDR_SRR_MASK;
            if (id & QEMU_CAN_RTR_FLAG)
                ret_id |= XCAN_IDR_RTR_MASK;
        } else {
            /* Standard CAN ID format */
            ret_id = ((id & QEMU_CAN_SFF_MASK) << XCAN_IDR_ID1_SHIFT) &
                XCAN_IDR_ID1_MASK;
            if (id & QEMU_CAN_RTR_FLAG)
                ret_id |= XCAN_IDR_SRR_MASK;
        }
        return ret_id;
    }

    static void generate_frame(qemu_can_frame *frame, uint32_t *data)
    {
        frame->can_id = id_xcan2can(data[0]);
        frame->can_dlc = FIELD_EX32(data[1], TXFIFO_DLC, DLC);

        frame->data[0] = FIELD_EX32(data[2], TXFIFO_DATA1, DB0);
        frame->data[1] = FIELD_EX32(data[2], TXFIFO_DATA1, DB1);
        frame->data[2] = FIELD_EX32(data[2], TXFIFO_DATA1, DB2);
        frame->data[3] = FIELD_EX32(data[2], TXFIFO_DATA1, DB3);

        frame->data[4] = FIELD_EX32(data[3], TXFIFO_DATA2, DB4);
        frame->data[5] = FIELD_EX32(data[3], TXFIFO_DATA2, DB5);
        frame->data[6] = FIELD_EX32(data[3], TXFIFO_DATA2, DB6);
        frame->data[7] = FIELD_EX32(data[3], TXFIFO_DATA2, DB7);
    }

    static void update_rx_fifo(XlnxZynqMPCANState *s, const qemu_can_frame *frame)
    {
        bool filter_pass = false;
        uint16_t timestamp = 0;

        /* If no filter is enabled. Message will be stored in FIFO. */
        if (!((ARRAY_FIELD_EX32(s->regs, AFR, UAF1)) |
        (ARRAY_FIELD_EX32(s->regs, AFR, UAF2)) |
        (ARRAY_FIELD_EX32(s->regs, AFR, UAF3)) |
        (ARRAY_FIELD_EX32(s->regs, AFR, UAF4)))) {
            filter_pass = true;
        }

        /*
        * Messages that pass any of the acceptance filters will be stored in
        * the RX FIFO.
        */
        if (ARRAY_FIELD_EX32(s->regs, AFR, UAF1)) {
            uint32_t id_masked = s->regs[R_AFMR1] & frame->can_id;
            uint32_t filter_id_masked = s->regs[R_AFMR1] & s->regs[R_AFIR1];

            if (filter_id_masked == id_masked) {
                filter_pass = true;
            }
        }

        if (ARRAY_FIELD_EX32(s->regs, AFR, UAF2)) {
            uint32_t id_masked = s->regs[R_AFMR2] & frame->can_id;
            uint32_t filter_id_masked = s->regs[R_AFMR2] & s->regs[R_AFIR2];

            if (filter_id_masked == id_masked) {
                filter_pass = true;
            }
        }

        if (ARRAY_FIELD_EX32(s->regs, AFR, UAF3)) {
            uint32_t id_masked = s->regs[R_AFMR3] & frame->can_id;
            uint32_t filter_id_masked = s->regs[R_AFMR3] & s->regs[R_AFIR3];

            if (filter_id_masked == id_masked) {
                filter_pass = true;
            }
        }

        if (ARRAY_FIELD_EX32(s->regs, AFR, UAF4)) {
            uint32_t id_masked = s->regs[R_AFMR4] & frame->can_id;
            uint32_t filter_id_masked = s->regs[R_AFMR4] & s->regs[R_AFIR4];

            if (filter_id_masked == id_masked) {
                filter_pass = true;
            }
        }

        if (!filter_pass) {
            trace_xlnx_can_rx_fifo_filter_reject(frame->can_id, frame->can_dlc);
            return;
        }

        /* Store the message in fifo if it passed through any of the filters. */
        if (filter_pass && frame->can_dlc <= MAX_DLC) {

            if (fifo32_is_full(&s->rx_fifo)) {
                ARRAY_FIELD_DP32(s->regs, INTERRUPT_STATUS_REGISTER, RXOFLW, 1);
            } else {
                timestamp = CAN_TIMER_MAX - ptimer_get_count(s->can_timer);

                fifo32_push(&s->rx_fifo, id_can2xcan(frame->can_id));

                fifo32_push(&s->rx_fifo, deposit32(0, R_RXFIFO_DLC_DLC_SHIFT,
                                                R_RXFIFO_DLC_DLC_LENGTH,
                                                frame->can_dlc) |
                                        deposit32(0, R_RXFIFO_DLC_RXT_SHIFT,
                                                R_RXFIFO_DLC_RXT_LENGTH,
                                                timestamp));

                /* First 32 bit of the data. */
                fifo32_push(&s->rx_fifo, deposit32(0, R_TXFIFO_DATA1_DB0_SHIFT,
                                                R_TXFIFO_DATA1_DB0_LENGTH,
                                                frame->data[0]) |
                                        deposit32(0, R_TXFIFO_DATA1_DB1_SHIFT,
                                                R_TXFIFO_DATA1_DB1_LENGTH,
                                                frame->data[1]) |
                                        deposit32(0, R_TXFIFO_DATA1_DB2_SHIFT,
                                                R_TXFIFO_DATA1_DB2_LENGTH,
                                                frame->data[2]) |
                                        deposit32(0, R_TXFIFO_DATA1_DB3_SHIFT,
                                                R_TXFIFO_DATA1_DB3_LENGTH,
                                                frame->data[3]));
                /* Last 32 bit of the data. */
                fifo32_push(&s->rx_fifo, deposit32(0, R_TXFIFO_DATA2_DB4_SHIFT,
                                                R_TXFIFO_DATA2_DB4_LENGTH,
                                                frame->data[4]) |
                                        deposit32(0, R_TXFIFO_DATA2_DB5_SHIFT,
                                                R_TXFIFO_DATA2_DB5_LENGTH,
                                                frame->data[5]) |
                                        deposit32(0, R_TXFIFO_DATA2_DB6_SHIFT,
                                                R_TXFIFO_DATA2_DB6_LENGTH,
                                                frame->data[6]) |
                                        deposit32(0, R_TXFIFO_DATA2_DB7_SHIFT,
                                                R_TXFIFO_DATA2_DB7_LENGTH,
                                                frame->data[7]));

                ARRAY_FIELD_DP32(s->regs, INTERRUPT_STATUS_REGISTER, RXOK, 1);
                trace_xlnx_can_rx_data(frame->can_id, frame->can_dlc,
                                    frame->data[0], frame->data[1],
                                    frame->data[2], frame->data[3],
                                    frame->data[4], frame->data[5],
                                    frame->data[6], frame->data[7]);
            }

            can_update_irq(s);
        }
    }
    ```

- 
    2022.06.09(æ™šä¸Š):æœ€è¿‘æ·»åŠ äº†can/pwm/timer/adcè¿™äº›æ¨¡å‹åˆ°quard star socä¸­ï¼Œå‡éªŒè¯æ­£ç¡®ï¼Œç„¶åä»Šå¤©æ·»åŠ äº†cadenceçš„gemç½‘å¡æ¨¡å‹ï¼Œç¼–å†™å¥½è®¾å¤‡æ ‘dtsæ–‡ä»¶åï¼Œè¿è¡Œå´å‘ç°ubootæ— æ³•å¯åŠ¨äº†ï¼Œè€Œä¸”å®Œå…¨æ²¡æœ‰æ‰“å°è¾“å‡ºï¼Œç»è¿‡ä¸€ç•ªæŸ¥æ‰¾å®šä½ï¼Œç»ˆäºæ‰¾åˆ°äº†é—®é¢˜ï¼Œu-boot-2021.07/drivers/serial/serial-uclass.c:79:serial_find_console_or_panicå‡½æ•°æœªèƒ½æ­£å¸¸å®Œæˆè€Œäº§ç”Ÿäº†panic_stræ–­è¨€ï¼Œç»§ç»­è¿½é€æœ€ç»ˆç¡®è®¤åœ¨ä»¥ä¸‹ä»£ç å¤„è¿”å›äº†-ENOMEMï¼ˆ-12ï¼‰é”™è¯¯æœ€ç»ˆå¯¼è‡´é—®é¢˜ã€‚
    
    ```c
    -> u-boot-2021.07/drivers/serial/serial-uclass.c:69:
        lists_bind_fdt(gd->dm_root, offset_to_ofnode(node), devp, false)
    -> u-boot-2021.07/drivers/core/lists.c:245:
        ret = device_bind_with_driver_data(parent, entry, name, id->data, node, &dev);
    -> u-boot-2021.07/drivers/core/device.c:62:
        dev = calloc(1, sizeof(struct udevice));
    ```

    å…¶å®æ ¹æœ¬åŸå› æ˜¯ç”±äºdtbæ–‡ä»¶çš„å¤§å°å¢åŠ å¯¼è‡´ubootåœ¨ä»£ç é‡å®šå‘å‰çš„å †å†…å­˜å¼€é”€å¢å¤§å¯¼è‡´çš„ï¼Œå› æ­¤ä¿®æ”¹åŠæ³•ä¸ºï¼Œåœ¨ubootä¸­çš„qemu-quard-star_defconfigæ–‡ä»¶å¢åŠ ä»¥ä¸‹é…ç½®è¦†ç›–é»˜è®¤çš„å †å†…å­˜å¤§å°ã€‚
    
    ```
    CONFIG_SYS_MALLOC_F_LEN=0x10000
    ```

- 
    2022.06.12(ä¸Šåˆ): æ·»åŠ PL111ååœ¨5.10ç‰ˆæœ¬çš„kernelé…ç½®é©±åŠ¨å°±å¯ä»¥æ­£ç¡®å¯ç”¨è®¾å¤‡ï¼Œä½†æ˜¯åœ¨linux-nextä¸Šå´æ— æ³•æ­£ç¡®å®Œæˆè®¾å¤‡æšä¸¾ï¼Œè€Œä¸”å±…ç„¶æ²¡æœ‰ä»»ä½•é”™è¯¯æ‰“å°ã€‚å› æ­¤è·Ÿè¸ªäº†ä¸‹é—®é¢˜ï¼Œé¦–å…ˆå®šä½åˆ°drivers/gpu/drm/pl111/pl111_drv.c:72:pl111_modeset_initè¿”å›äº†-EPROBE_DEFERé”™è¯¯ï¼Œç”±äºæ— æ³•æ‰¾åˆ°panelï¼Œå› æ­¤è½¬è€Œè·Ÿè¸ªdrivers/gpu/drm/panel/panel-simple.cå‘ç°å¯åŠ¨è¿‡ç¨‹ä¸­å®Œå…¨æ²¡æœ‰è°ƒç”¨panel_simple_platform_probeå‡½æ•°ï¼Œè¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿä¸ºæ­¤åªå¥½å»è°ƒæŸ¥å†…æ ¸çš„é©±åŠ¨æ¡†æ¶çš„ä»£ç ï¼Œå®šä½è¿™ä¸ªæ–‡ä»¶â€”â€”drivers/base/dd.cï¼Œè®¾å¤‡é€šè¿‡è®¾å¤‡æ ‘è§£æåå¼€å§‹è¿›ä¸€æ­¥åŒ¹é…attachï¼Œå¤§è‡´è·¯å¾„ä¸ºdevice_attach-->__device_attach_driver-->driver_match_device/driver_probe_deviceï¼Œæ­¤æ—¶å‘ç°match_deviceæ­£å¸¸ï¼Œprobe_deviceå¤±è´¥ï¼Œè¿›ä¸€æ­¥è°ƒæŸ¥__driver_probe_device-->really_probe-->device_links_check_suppliersï¼Œæ­¤æ—¶å‘ç°ä½äºdrivers/base/core.c:890:device_links_check_supplierså‡½æ•°1038è¡Œè¿”å›äº†-EPROBE_DEFERé”™è¯¯ï¼Œå› æ­¤panel-simpleå°±å®Œå…¨æ²¡æœ‰å»è°ƒç”¨probeå‡½æ•°ï¼Œè¿™é‡Œæ‰“å°å‡ºdev_name(link->supplier)ä¿¡æ¯å‘ç°ï¼ŒåŸæ¥æ˜¯æ·»åŠ çš„è®¾å¤‡æ ‘æ–°æ·»åŠ çš„power-supplyå’Œbacklightæœ¬èº«æ²¡æœ‰probeï¼Œå› æ­¤panelå°±æ— æ³•probeï¼ŒåŸæ¥åªæ˜¯è‡ªå·±å¿˜è®°é…ç½®è¿™ä¸¤ä¸ªé©±åŠ¨åœ¨configæ–‡ä»¶é‡Œäº†ğŸ¤£ï¼Œæˆ‘æç€ç»•äº†ä¸€å¤§åœˆï¼Œå°±è¿™ä¹ˆç®€å•ä¸ªå°é”™è¯¯ï¼Œåœ¨æ­¤è®°å½•ä¸‹ä»¥ç¤ºè­¦æˆ’è‡ªå·±ï¼Œä¸è¿‡è¿™æ¬¡é˜…è¯»ä»£ç ä¹Ÿæœ‰å¥½å¤„ï¼Œå°±æ˜¯æŠŠå†…æ ¸çš„é©±åŠ¨æ¡†æ¶å’Œè®¾å¤‡æ ‘è§£ææ›´åŠ ç†Ÿæ‚‰äº†ã€‚

    ```dts
    panel {
		compatible = "panel-dpi";
		label = "lcd";
		power-supply = <&reg_3p3v>;
		backlight = <&backlight>;
		status = "okay";

		panel-timing {
			clock-frequency = <25175000>;
			hactive = <640>;
			hback-porch = <40>;
			hfront-porch = <24>;
			hsync-len = <96>;
			vactive = <480>;
			vback-porch = <32>;
			vfront-porch = <11>;
			vsync-len = <2>;
		};

		port {
			lcdc_panel: endpoint {
				remote-endpoint = <&lcdc_pads>;
			};
		};
	};
    ``` 

- 
    2022.06.12(ä¸Šåˆ): æ·»åŠ äº†watchdogæ¨¡å‹ï¼Œè¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œé¡ºä¾¿ç ”ç©¶äº†ä¸€ä¸‹watchdogdæœºåˆ¶ã€‚
- 
    2022.06.12(ä¸‹åˆ): ç°åœ¨å¸¸è§çš„ç¡¬ä»¶ipæ¨¡å‹åŸºæœ¬ä¸Šå…¨äº†ï¼Œçªç„¶æƒ³åœ¨ubooté˜¶æ®µå°±é©±åŠ¨PL111è¾“å‡ºä¸€ä¸ªå¼€æœºlogoï¼Œæœ¬æ¥æˆ‘ä»¥ä¸ºå¾ˆç®€å•ï¼Œæ²¡æƒ³åˆ°ubootå±…ç„¶æ²¡æœ‰PL111çš„videoé©±åŠ¨ï¼Œé‚£å°±è‡ªå·±æ‰‹å†™ä¸€ä¸ªéå¸¸ç®€å•ç²—ç³™çš„å§

    ```c
    // SPDX-License-Identifier: GPL-2.0+

    #define LOG_CATEGORY UCLASS_VIDEO

    #include <common.h>
    #include <clk.h>
    #include <display.h>
    #include <dm.h>
    #include <log.h>
    #include <panel.h>
    #include <reset.h>
    #include <video.h>
    #include <video_bridge.h>
    #include <asm/io.h>
    #include <asm/arch/gpio.h>
    #include <dm/device-internal.h>
    #include <dm/device_compat.h>
    #include <linux/bitops.h>
    #include <config.h>
    
    #define VIDEO_PL111_MAX_XRES (1024)
    #define VIDEO_PL111_MAX_YRES (768)
    #define VIDEO_PL111_MAX_BPP  (24)
    
    struct pl111_priv {
    	void __iomem *regs;
    	enum video_log2_bpp l2bpp;
    };
    
    /* PL111 main registers */
    #define CLCD_TIM0		0x00000000
    #define CLCD_TIM1		0x00000004
    #define CLCD_TIM2		0x00000008
    #define CLCD_TIM3		0x0000000c
    #define CLCD_UBAS		0x00000010
    #define CLCD_LBAS		0x00000014
    
    #define CLCD_PL111_CNTL		0x00000018
    #define CLCD_PL111_IENB		0x0000001c
    #define CLCD_PL111_RIS		0x00000020
    #define CLCD_PL111_MIS		0x00000024
    #define CLCD_PL111_ICR		0x00000028
    #define CLCD_PL111_UCUR		0x0000002c
    #define CLCD_PL111_LCUR		0x00000030
    
    #define CNTL_LCDEN		(1 << 0)
    #define CNTL_LCDBPP1		(0 << 1)
    #define CNTL_LCDBPP2		(1 << 1)
    #define CNTL_LCDBPP4		(2 << 1)
    #define CNTL_LCDBPP8		(3 << 1)
    #define CNTL_LCDBPP16		(4 << 1)
    #define CNTL_LCDBPP16_565	(6 << 1)
    #define CNTL_LCDBPP16_444	(7 << 1)
    #define CNTL_LCDBPP24		(5 << 1)
    #define CNTL_LCDBW		(1 << 4)
    #define CNTL_LCDTFT		(1 << 5)
    #define CNTL_LCDMONO8		(1 << 6)
    #define CNTL_LCDDUAL		(1 << 7)
    #define CNTL_BGR		(1 << 8)
    #define CNTL_BEBO		(1 << 9)
    #define CNTL_BEPO		(1 << 10)
    #define CNTL_LCDPWR		(1 << 11)
    #define CNTL_LCDVCOMP(x)	((x) << 12)
    #define CNTL_LDMAFIFOTIME	(1 << 15)
    #define CNTL_WATERMARK		(1 << 16)
    
    enum pl111_pix_fmt {
    	PF_BPP1 = 0,
    	PF_BPP2,
    	PF_BPP4,
    	PF_BPP8,
    	PF_BPP16,
    	PF_BPP24,
    	PF_BPP16_565,
    	PF_BPP12_444
    };
    
    static u32 pl111_get_pixel_format(enum video_log2_bpp l2bpp)
    {
    	enum pl111_pix_fmt pf;
    
    	switch (l2bpp) {
    	case VIDEO_BPP1:
    		pf = PF_BPP1;
    		break;
    	case VIDEO_BPP2:
    		pf = PF_BPP2;
    		break;
    	case VIDEO_BPP4:
    		pf = PF_BPP4;
    		break;
    	case VIDEO_BPP8:
    		pf = PF_BPP8;
    		break;
    	case VIDEO_BPP16:
    		pf = PF_BPP16_565;
    		break;
    	case VIDEO_BPP32:
    	default:
    		log_warning("warning %dbpp not supported yet, %dbpp     instead\n",
    			    VNBITS(l2bpp), VNBITS(VIDEO_BPP16));
    		pf = PF_BPP16_565;
    		break;
    	}
    
    	log_debug("%d bpp -> ltdc pf %d\n", VNBITS(l2bpp), pf);
    
    	return (u32)pf;
    }
    
    static void pl111_enable(struct pl111_priv *priv)
    {
    	size_t regs_addr = (size_t)priv->regs;
    	setbits_le32(regs_addr + CLCD_PL111_CNTL, CNTL_LCDPWR);
    }
    
    static void pl111_set_mode(struct pl111_priv *priv,
    				struct display_timing *timings, ulong     fb_addr)
    {
    	size_t regs_addr = (size_t)priv->regs;
    	u32 ppl, hsw, hfp, hbp;
    	u32 lpp, vsw, vfp, vbp;
    	u32 format;
    
    	ppl = (timings->hactive.typ / 16) - 1;
    	hsw = timings->hsync_len.typ;
    	hfp = timings->hfront_porch.typ;
    	hbp = timings->hback_porch.typ;
    
    	lpp = timings->vactive.typ - 1;
    	vsw = timings->vsync_len.typ;
    	vfp = timings->vfront_porch.typ;
    	vbp = timings->vback_porch.typ;
    
    	writel((ppl << 2) | (hsw << 8) | (hfp << 16) | (hbp <<     24),
    	       regs_addr + CLCD_TIM0);
    	writel(lpp | (vsw << 10) | (vfp << 16) | (vbp << 24),
    	       regs_addr + CLCD_TIM1);
    
    	format = pl111_get_pixel_format(priv->l2bpp);
    
    	writel(CNTL_LCDEN | CNTL_LCDTFT | CNTL_BGR | (format <<     1), regs_addr + CLCD_PL111_CNTL);
    
    	writel((uint32_t)fb_addr, regs_addr + CLCD_UBAS);
    }
    
    static int pl111_probe(struct udevice *dev)
    {
    	struct video_uc_plat *uc_plat = dev_get_uclass_plat(dev)    ;
    	struct video_priv *uc_priv = dev_get_uclass_priv(dev);
    	struct pl111_priv *priv = dev_get_priv(dev);
    	struct display_timing timings;
    	struct clk pclk;
    	struct reset_ctl rst;
    	int ret;
    
    	priv->regs = (void *)dev_read_addr(dev);
    	if ((fdt_addr_t)priv->regs == FDT_ADDR_T_NONE) {
    		dev_err(dev, "pl111 dt register address error\n");
    		return -EINVAL;
    	}
    
    	ret = clk_get_by_index(dev, 0, &pclk);
    	if (ret) {
    		dev_err(dev, "peripheral clock get error %d\n", ret)    ;
    		return ret;
    	}
    
    	ret = clk_enable(&pclk);
    	if (ret) {
    		dev_err(dev, "peripheral clock enable error %d\n",     ret);
    		return ret;
    	}
    
    	ret = ofnode_decode_display_timing(dev_ofnode(dev),
    						0, &timings);
    	if (ret) {
    		dev_err(dev, "decode display timing error %d\n",     ret);
    		return ret;
    	}
    
    	/* TODO Below parameters are hard-coded for the moment..    . */
    	priv->l2bpp = VIDEO_BPP16;
    
    	/* Configure & start LTDC */
    	pl111_set_mode(priv, &timings, uc_plat->base);
    	pl111_enable(priv);
    
    	uc_priv->xsize = timings.hactive.typ;
    	uc_priv->ysize = timings.vactive.typ;
    	uc_priv->bpix = priv->l2bpp;
    
    	video_set_flush_dcache(dev, true);
    
    	return 0;
    }
    
    static int pl111_bind(struct udevice *dev)
    {
    	struct video_uc_plat *uc_plat = dev_get_uclass_plat(dev)    ;
    
    	uc_plat->size = VIDEO_PL111_MAX_XRES *     VIDEO_PL111_MAX_YRES *
    			(VIDEO_PL111_MAX_BPP >> 3);
    	dev_dbg(dev, "frame buffer max size %d bytes\n",     uc_plat->size);
    
    	return 0;
    }
    
    static const struct udevice_id pl111_ids[] = {
    	{ .compatible = "arm,pl111" },
    	{ }
    };
    
    U_BOOT_DRIVER(pl111) = {
    	.name			= "pl111_display",
    	.id			= UCLASS_VIDEO,
    	.of_match		= pl111_ids,
    	.probe			= pl111_probe,
    	.bind			= pl111_bind,
    	.priv_auto	= sizeof(struct pl111_priv),
    };

    ```

    ubootå¯åŠ¨åè¦æƒ³è¾“å‡ºå¼€æœºlogoè¿˜éœ€è¦åœ¨board_late_inité‡ŒåŠ è½½bmpå›¾åƒæ•°æ®åˆ°è®¾å¤‡é‡Œï¼Œä»£ç å¦‚ä¸‹ã€‚OKï¼Œç°åœ¨å¤§åŠŸå‘Šæˆã€‚ç„¶åæˆ‘å‘ç°æˆ‘ä»¬è¿™ä¸ªé¡¹ç›®å±…ç„¶æ²¡æœ‰logoï¼Œæˆ‘åªå¥½å…ˆç”¨ubootçš„logåšå¼€æœºç”»é¢äº†ï¼Œçœ‹æ¥è®¾è®¡logoçš„äº‹æƒ…è¦æä¸Šæ—¥ç¨‹äº†ã€‚

    ```c
    int video_show_board_info(void) 
    {
        struct udevice *dev;
        int ret;

        ret = uclass_get_device(UCLASS_VIDEO, 0, &dev);
        if (ret)
            return ret;
        ret = video_bmp_display(dev, (ulong)logo, 0, 0, false);
        if (ret)
            return ret;
    }
    ```

- 
    2022.07.12(å‡Œæ™¨): æœ€è¿‘èº«ä½“çŠ¶å†µä¸æ˜¯å¾ˆå¥½ï¼Œå‰å‡ å¤©éå¸¸ä¸¥é‡çš„å¤±çœ ã€‚ä»Šå¤©æƒ³releaseä¸ªæ–°ç‰ˆæœ¬ï¼Œç»è¿‡å‰ä¸€æ®µæ—¶é—´çš„å¼€å‘ç›®å‰quard star socä¸­çš„å„ç±»controller ipå·²ç»éå¸¸å®Œå–„äº†ï¼Œç›¸å¯¹v0.0.2ç‰ˆæœ¬å˜åŒ–è¾ƒå¤§ï¼Œä¹Ÿä¿®å¤äº†ä¸å°‘é—®é¢˜ï¼Œrootfsæ„å»ºä¹Ÿæ­å»ºäº†ciï¼Œç°åœ¨æ˜¯ä¸ªå‘å¸ƒç‰ˆæœ¬v0.0.3çš„å¥½æ—¶æœºï¼Œå¦å¤–ä»Šå¤©æ˜¯æˆ‘å–œæ¬¢çš„å¥³ç”Ÿçš„ç”Ÿæ—¥ï¼Œç¥æ„¿å¥¹ç”Ÿæ—¥å¿«ä¹ğŸ‚ã€‚
- 
    2022.08.29(ä¸‹åˆ): çªç„¶å‘ç°spidevçš„è®¾å¤‡æ ‘å†™æ³•ï¼ˆå¦‚ä¸‹ç¤ºä¾‹ï¼‰åœ¨linux 5.17ä¹‹åä¸å†æ”¯æŒï¼Œå¿…é¡»è¦æ˜ç¡®æŒ‡å®šè®¾å¤‡ç±»å‹åŒ¹é…compatibleæ‰è¡Œã€‚

    ```
    &qspi1 {
        status = "okay";

        spidev@0{
            compatible = "spidev";
            reg = <0>;
            spi-max-frequency = <4000000>;
        };
    };
    ```
    
    é‚£ä¹ˆå¦‚ä½•ä½¿ç”¨ä¹‹å‰çš„ç”¨æˆ·å±‚spiæ¥å£å‘¢ï¼ŸæŸ¥çœ‹[spidev.rst](https://elixir.bootlin.com/linux/v5.17/source/Documentation/spi/spidev.rst)å¯ä»¥çœ‹åˆ°ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯ä»¥ç›´æ¥æ³¨å†Œç”Ÿæˆ/dev/spidev1.0è®¾å¤‡ï¼Œä»£æ›¿åŸæœ¬è®¾å¤‡æ ‘çš„å›ºå®šå†™æ³•ï¼Œæ–°çš„ç”¨æ³•æ˜¾ç„¶æ˜¯æ›´åŠ çµæ´»çš„ï¼Œç‚¹èµã€‚

    ```shell
	echo spidev > /sys/bus/spi/devices/spi1.0/driver_override
	echo spi1.0 > /sys/bus/spi/drivers/spidev/bind
    ```

- 
    2022.10.06(å‡Œæ™¨): åœ¨macbook airä¸Šç¼–è¯‘è¿è¡Œokï¼Œå‘ç°ä½¿ç”¨gcc12.2ç‰ˆæœ¬ç¼–è¯‘çš„6.0.0çš„kernelå­˜åœ¨é—®é¢˜ï¼Œåé¢æœ‰ç©ºå†æŸ¥æŸ¥ï¼Œç›®å‰ä½¿ç”¨gcc11ç‰ˆæœ¬æ²¡é—®é¢˜ã€‚


- 
    2022.10.07(æ—©ä¸Š): ä¹‹å‰å‘ç°çš„gcc12ç¼–è¯‘çš„6.0.0çš„kernelå­˜åœ¨é—®é¢˜å·²ç»å®šä½åˆ°ï¼Œç”±äºgcc12æ”¯æŒäº†ZICBOMæœ€æ–°æ‰©å±•ä½†KVMè¿™è¾¹æ²¡æœ‰åˆ¤æ–­ä¸­ä¸å¼€å¯CONFIG_RISCV_DMA_NONCOHERENTå®çš„æƒ…å†µé€ æˆç¼–è¯‘å‡ºé”™ï¼Œè¿™é‡Œä¿®æ”¹arch/riscv/kvm/vcpu.cè¿™ä¸ªå‡½æ•°å³å¯è§£å†³ã€‚

    ```shell
    static int kvm_riscv_vcpu_get_reg_config(struct kvm_vcpu *vcpu,
                        const struct kvm_one_reg *reg)
    {
        unsigned long __user *uaddr =
                (unsigned long __user *)(unsigned long)reg->addr;
        unsigned long reg_num = reg->id & ~(KVM_REG_ARCH_MASK |
                            KVM_REG_SIZE_MASK |
                            KVM_REG_RISCV_CONFIG);
        unsigned long reg_val;

        if (KVM_REG_SIZE(reg->id) != sizeof(unsigned long))
            return -EINVAL;

        switch (reg_num) {
        case KVM_REG_RISCV_CONFIG_REG(isa):
            reg_val = vcpu->arch.isa[0] & KVM_RISCV_BASE_ISA_MASK;
            break;
        case KVM_REG_RISCV_CONFIG_REG(zicbom_block_size):
            if (!riscv_isa_extension_available(vcpu->arch.isa, ZICBOM))
                return -EINVAL;
    #ifndef CONFIG_RISCV_DMA_NONCOHERENT
            return -EINVAL;
    #else
            reg_val = riscv_cbom_block_size;
            break;
    #endif
        default:
            return -EINVAL;
        }

        if (copy_to_user(uaddr, &reg_val, KVM_REG_SIZE(reg->id)))
            return -EFAULT;

        return 0;
    }
    ```

- 
    2022.10.18(æ™šä¸Š): æœ€è¿‘å‡ å¤©guiå‰ç«¯toolså·¥å…·æ·»åŠ äº†æ›´å¤šåŠŸèƒ½ï¼ŒæŸ¥è¯¢æ¥å£ä¿¡æ¯å’Œhelpå¸®åŠ©ï¼Œå¤šè¯­è¨€æ·»åŠ æ—¥è¯­ç‰ˆæœ¬ã€‚

- 
    2022.10.26(æ™šä¸Š): ä¼˜åŒ–ä¸€äº›è„šæœ¬ï¼Œæ›´å¥½çš„æ”¯æŒåœ¨macå¼€å‘ï¼Œå› ä¸ºæˆ‘ç°åœ¨åœ¨macä¸Šå†™ä»£ç çš„é¢‘ç‡è¶Šæ¥è¶Šå¤šï¼Œåé¡»è¿™ä¸ªé¡¹ç›®çš„å¼€å‘æˆ‘éƒ½ä¼šåœ¨macä¸Šè¿›è¡Œï¼Œä¸è¿‡ï¼Œè¿™ä¸ªé¡¹ç›®ä½œä¸ºè·¨å¹³å°é¡¹ç›®ï¼Œä¾æ—§æ˜¯æ”¯æŒä¸‰å¹³å°ä½¿ç”¨ï¼ŒåŒæ—¶æœ€å¥½çš„å¼€å‘ä½“éªŒä¾æ—§æ˜¯åœ¨Linuxç¯å¢ƒæ˜¯ä¸ä¼šæ”¹å˜çš„ã€‚

- 
    2022.11.26(æ™šä¸Š): åˆå¹¶äº†æœ€æ–°çš„next kenrelåçªç„¶åˆæ— æ³•è¿è¡Œäº†ï¼Œé—®é¢˜å‡ºç°åœ¨kenrelåˆå§‹åŒ–é…ç½®é¡µè¡¨å†…å­˜åˆå§‹åŒ–æ—¶ï¼ŒåˆèŠ±äº†äº›æ—¶é—´å®šä½ï¼Œæœ€ç»ˆå‘ç°å†…æ ¸ä¸­å¯¹åˆå§‹åŒ–å†…å­˜åšäº†ä¿®æ”¹ï¼Œä¸å†åˆ¤æ–­reserved memoryå¯¼è‡´ä¹‹å‰æˆ‘åœ¨opensbiåˆ†é…ç»™trusted domainæ—¶çš„å†…å­˜åœ°å€è¢«kernelè®¿é—®äº†ï¼Œå› æ­¤è§¦å‘äº†å¼‚å¸¸ï¼Œå› æ­¤ä¿®æ”¹è¿™ä¸ªé—®é¢˜å°±å…ˆç®€å•çš„ä¿®æ”¹kernelçš„dtsæ–‡ä»¶ï¼Œå»æ‰åˆ†é…ç»™trusted domainçš„å†…å­˜ã€‚

    ```dts
    memory@80000000 {
		device_type = "memory";
		reg = <0x0 0x80000000 0x0 0x3f800000>;
	};
    ```

- 
    2022.12.04(å‡Œæ™¨): æœ€è¿‘æ·»åŠ äº†ifpulgdç›‘æµ‹ç½‘ç»œæ¥å£é“¾æ¥ï¼ŒåŒæ—¶ä¸ºäº†åœ¨qemuä¸Šæ›´å¥½çš„æ¨¡æ‹Ÿï¼Œguiå‰ç«¯toolså·¥å…·ç»§ç»­æ·»åŠ æ›´å¤šåŠŸèƒ½ä»¥æ”¯æŒä¾¿æºä½¿ç”¨ã€‚

-
    2023.04.27(æ™šä¸Š): u-bootæ›´æ–°åˆ°2023.04ç‰ˆæœ¬ï¼Œå®Œå–„äº†æ›´å¤šbooté€‰é¡¹ã€‚
